"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[90],{90:(on,x,a)=>{a.r(x),a.d(x,{TrainPageModule:()=>V});var d=a(6019),f=a(9133),r=a(4662),u=a(1880),$=a(4099),y=a(9204),p=a(8717),g=a(8260),m=a(8761),v=a(7539),A=a(3051),q=a(5305),n=a(3668),b=a(607),M=a(6382),R=a(3093),S=a(5722),h=a(8775),P=a(2445),Z=a(3085);function J(e,s){1&e&&n._UZ(0,"app-choose-players")}function O(e,s){if(1&e){const o=n.EpF();n.TgZ(0,"ion-col",12),n.TgZ(1,"ion-chip",13),n.NdJ("click",function(){const c=n.CHM(o).$implicit,l=n.oxw(2).$implicit,_=n.oxw(2);return _.addToScoresLine(l._id,c*_.inverse[l._id])}),n.TgZ(2,"ion-label"),n._uU(3),n.qZA(),n.qZA(),n.qZA()}if(2&e){const o=s.$implicit,t=n.oxw(2).$implicit,i=n.oxw(2);n.xp6(1),n.Q6J("color",o>19?"secondary":"warning"),n.xp6(2),n.Oqu(o*i.inverse[t._id])}}function w(e,s){if(1&e){const o=n.EpF();n.TgZ(0,"ion-col",12),n.TgZ(1,"ion-chip",17),n.NdJ("click",function(){const c=n.CHM(o).$implicit,l=n.oxw(2).$implicit;return n.oxw(2).removeFromScoresLine(l._id,c)}),n.TgZ(2,"ion-label"),n._uU(3),n.qZA(),n._UZ(4,"ion-icon",18),n.qZA(),n.qZA()}if(2&e){const o=s.$implicit;n.xp6(1),n.Q6J("color",o>19?"secondary":"warning"),n.xp6(2),n.Oqu(o)}}function F(e,s){if(1&e){const o=n.EpF();n.TgZ(0,"ion-card-content"),n.TgZ(1,"ion-row",10),n.YNc(2,O,4,2,"ion-col",11),n.TgZ(3,"ion-col",12),n.TgZ(4,"ion-chip",13),n.NdJ("click",function(){n.CHM(o);const i=n.oxw().$implicit;return n.oxw(2).inverseScore(i._id)}),n._UZ(5,"ion-icon",14),n._UZ(6,"ion-icon",15),n.qZA(),n.qZA(),n.qZA(),n.TgZ(7,"ion-row",16),n.YNc(8,w,5,2,"ion-col",11),n.qZA(),n.qZA()}if(2&e){const o=n.oxw().$implicit,t=n.oxw(2);n.xp6(2),n.Q6J("ngForOf",t.routeScoresEnv),n.xp6(2),n.Q6J("color","danger"),n.xp6(4),n.Q6J("ngForOf",t.getMemberByPlayer_id(o._id).scoresLine)}}function L(e,s){if(1&e){const o=n.EpF();n.TgZ(0,"ion-card-content"),n.TgZ(1,"ion-row"),n.TgZ(2,"ion-col",10),n.TgZ(3,"div"),n._uU(4),n.ALo(5,"translate"),n.qZA(),n.TgZ(6,"ion-toggle",19),n.NdJ("ionChange",function(i){n.CHM(o);const c=n.oxw().$implicit;return n.oxw(2).onMarkLongestHandler(i,c._id)}),n.qZA(),n.qZA(),n.qZA(),n.qZA()}if(2&e){const o=n.oxw().$implicit,t=n.oxw(2);n.xp6(4),n.Oqu(n.lcZ(5,2,"games.train.longestRoute")),n.xp6(2),n.Q6J("checked",t.getMemberByPlayer_id(o._id).scoresLine.length)}}function N(e,s){if(1&e){const o=n.EpF();n.TgZ(0,"ion-card-content"),n.TgZ(1,"ion-row",10),n.TgZ(2,"ion-col",20),n.TgZ(3,"ion-label"),n._uU(4),n.qZA(),n.qZA(),n.TgZ(5,"ion-col",21),n.TgZ(6,"div",22),n.TgZ(7,"ion-button",23),n.NdJ("click",function(){n.CHM(o);const i=n.oxw().$implicit;return n.oxw(2).addToScoresLine(i._id,4)}),n._UZ(8,"ion-icon",15),n.qZA(),n.TgZ(9,"span",24),n.TgZ(10,"div"),n._uU(11),n.ALo(12,"translate"),n.qZA(),n.qZA(),n.TgZ(13,"ion-button",25),n.NdJ("click",function(){n.CHM(o);const i=n.oxw().$implicit;return n.oxw(2).removeFromScoresLine(i._id,4)}),n._UZ(14,"ion-icon",14),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()}if(2&e){const o=n.oxw().$implicit,t=n.oxw(2);n.xp6(4),n.Oqu(3-t.calcScores(o._id)/4),n.xp6(3),n.Q6J("disabled",t.getMemberByPlayer_id(o._id).scoresLine.length>=3),n.xp6(4),n.Oqu(n.lcZ(12,4,"games.train.stationsShort")),n.xp6(2),n.Q6J("disabled",t.getMemberByPlayer_id(o._id).scoresLine.length<=0)}}function Q(e,s){if(1&e){const o=n.EpF();n.TgZ(0,"ion-row",10),n.TgZ(1,"ion-col",20),n.TgZ(2,"ion-label"),n._uU(3),n.qZA(),n.qZA(),n.TgZ(4,"ion-col",21),n.TgZ(5,"div",22),n.TgZ(6,"ion-button",27),n.NdJ("click",function(){const c=n.CHM(o).$implicit,l=n.oxw(2).$implicit;return n.oxw(2).removeFromScoresLine(l._id,c.score)}),n._UZ(7,"ion-icon",15),n.qZA(),n.TgZ(8,"span",24),n._UZ(9,"ion-icon",28),n._uU(10),n.qZA(),n.TgZ(11,"ion-button",29),n.NdJ("click",function(){const c=n.CHM(o).$implicit,l=n.oxw(2).$implicit;return n.oxw(2).addToScoresLine(l._id,c.score)}),n._UZ(12,"ion-icon",14),n.qZA(),n.qZA(),n.qZA(),n.qZA()}if(2&e){const o=s.$implicit,t=n.oxw(2).$implicit,i=n.oxw(2);n.xp6(3),n.Oqu(i.calcQtyOfArrItems(t._id,o.score)),n.xp6(7),n.hij(" ",o.qty," ")}}function U(e,s){if(1&e&&(n.TgZ(0,"ion-card-content"),n.YNc(1,Q,13,2,"ion-row",26),n.qZA()),2&e){const o=n.oxw(3);n.xp6(1),n.Q6J("ngForOf",o.carsCfg)}}const Y=function(e){return{"border-bottom":e}};function H(e,s){if(1&e&&(n.TgZ(0,"ion-card"),n.TgZ(1,"ion-card-header",3),n.TgZ(2,"ion-card-subtitle"),n.TgZ(3,"span",4),n._UZ(4,"ion-icon",5),n.TgZ(5,"span",6),n._uU(6),n.ALo(7,"translate"),n.qZA(),n._UZ(8,"span",7),n.TgZ(9,"span"),n._uU(10),n.qZA(),n.qZA(),n.qZA(),n.TgZ(11,"ion-card-title",8),n._uU(12),n.qZA(),n.qZA(),n.YNc(13,F,9,3,"ion-card-content",9),n.YNc(14,L,7,4,"ion-card-content",9),n.YNc(15,N,15,6,"ion-card-content",9),n.YNc(16,U,2,1,"ion-card-content",9),n.qZA()),2&e){const o=s.$implicit,t=n.oxw(2);n.xp6(1),n.Q6J("ngStyle",n.VKq(11,Y,"2px solid "+t.getPlayerColor(o._id))),n.xp6(3),n.Q6J("name",null==t.activeRound?null:t.activeRound.icon),n.xp6(2),n.Oqu(n.lcZ(7,9,"games.train."+(null==t.activeRound?null:t.activeRound._id))),n.xp6(4),n.Oqu(t.calcScores(o._id)),n.xp6(2),n.Oqu(t.getPlayerName(o._id)),n.xp6(1),n.Q6J("ngIf","routes"===t.round._id),n.xp6(1),n.Q6J("ngIf","length"===t.round._id),n.xp6(1),n.Q6J("ngIf","stations"===t.round._id),n.xp6(1),n.Q6J("ngIf","cars"===t.round._id)}}function j(e,s){if(1&e&&n.YNc(0,H,17,13,"ion-card",2),2&e){const o=n.oxw();n.Q6J("ngForOf",o.players)}}let I=(()=>{class e{constructor(o,t){this.route=o,this.store=t,this.roundsCfg=g.N.games.train.rounds,this.carsCfg=g.N.games.train.cars,this.routeScoresEnv=g.N.games.train.routeScores,this.inverse={}}ngOnInit(){this.activeRound$.pipe((0,S.b)(o=>this.activeRound=o),(0,y.w)(o=>this.store.select(m.N_(o._id)))).subscribe(o=>{o&&(this.round=o)}),this.rounds$=this.store.select(m.PK),this.rounds$.subscribe(o=>{this.rounds=o}),this.roundMembers$=this.store.select(v.uW),this.roundMembers$.subscribe(o=>{this.roundMembers=o}),this.players$=this.store.select(A.y1),this.players$.subscribe(o=>{this.players=o,this.players.forEach(t=>this.inverse[t._id]=1)})}calcScores(o){return this.getMemberByPlayer_id(o).scoresLine.reduce((t,i)=>t+i,0)}getPlayerColor(o){return this.players.find(t=>t._id===o).color}getPlayerName(o){return this.players.find(t=>t._id===o).name}getMemberByPlayer_id(o){return this.roundMembers.filter(t=>t.player===o&&this.round.roundMembers.includes(t._id))[0]}calcQtyOfArrItems(o,t){let i=0;return this.getMemberByPlayer_id(o).scoresLine.forEach(c=>{c===t&&i++}),i}inverseScore(o){this.inverse[o]=-1*this.inverse[o]}addToScoresLine(o,t){const i=this.getMemberByPlayer_id(o),c=Object.assign(Object.assign({},i),{scoresLine:[...i.scoresLine,t]});this.store.dispatch(h.hx({roundMember:{id:i._id,changes:c}}))}removeFromScoresLine(o,t){const i=this.getMemberByPlayer_id(o),c=[...i.scoresLine],l=c.indexOf(t);c.splice(l,1);const _=Object.assign(Object.assign({},i),{scoresLine:c});this.store.dispatch(h.hx({roundMember:{id:i._id,changes:_}}))}setScoresLine(o,t){const i=this.getMemberByPlayer_id(o),c=Object.assign(Object.assign({},i),{scoresLine:t});this.store.dispatch(h.hx({roundMember:{id:i._id,changes:c}}))}onMarkLongestHandler(o,t){this.setScoresLine(t,o.target.checked?[10]:[])}onChangeStationsHandler(o){console.log("e-value",o.target.value)}}return e.\u0275fac=function(o){return new(o||e)(n.Y36(u.gz),n.Y36(b.yh))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-train-rounds"]],inputs:{activeRound$:"activeRound$"},decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["restRounds",""],[4,"ngFor","ngForOf"],[3,"ngStyle"],[1,"round-subtitle"],["color","primary",1,"round-subtitle__icon",3,"name"],[1,"ion-text-capitalize","round-subtitle__text"],[1,"round-subtitle__blank"],[1,"ion-text-center"],[4,"ngIf"],[1,"round","round_tools"],["size","3",4,"ngFor","ngForOf"],["size","3"],[3,"color","click"],["name","add-outline"],["name","remove-outline"],[1,"round","round_result"],["outline","",3,"color","click"],["name","close-circle"],[3,"checked","ionChange"],[1,"round_tools__score"],[1,"round_tools__btn"],[1,"incDecBtn"],["shape","round","color","danger","fill","outline",3,"disabled","click"],[1,"incDecBtn__caption"],["shape","round","color","success","fill","outline",3,"disabled","click"],["class","round round_tools",4,"ngFor","ngForOf"],["shape","round","color","danger","fill","outline",3,"click"],["name","train-outline"],["shape","round","color","success","fill","outline",3,"click"]],template:function(o,t){if(1&o&&(n.YNc(0,J,1,0,"app-choose-players",0),n.ALo(1,"async"),n.YNc(2,j,1,1,"ng-template",null,1,n.W1O)),2&o){const i=n.MAs(3);n.Q6J("ngIf","start"===(null==t.activeRound?null:t.activeRound._id)&&0===n.lcZ(1,2,t.rounds$).length)("ngIfElse",i)}},directives:[d.O5,P.U,d.sg,r.PM,r.Zi,d.PC,r.tO,r.gu,r.Dq,r.FN,r.Nd,r.wI,r.hM,r.Q$,r.ho,r.w,r.YG],pipes:[d.Ov,Z.X$],styles:[""]}),e})();function k(e,s){if(1&e&&(n.TgZ(0,"ion-segment-button",8),n.ALo(1,"async"),n.ALo(2,"async"),n._UZ(3,"ion-icon",9),n.qZA()),2&e){const o=s.$implicit,t=n.oxw();n.Q6J("value",o)("disabled","start"===o._id&&n.lcZ(1,3,t.rounds$).length||"start"!==o._id&&0===n.lcZ(2,5,t.rounds$).length),n.xp6(3),n.Q6J("name",o.icon)}}const B=function(e){return{"border-left":e,"padding-left":"10px"}},G=function(e){return{"border-right":e,"padding-right":"10px"}};function E(e,s){if(1&e&&(n.TgZ(0,"ion-item"),n.TgZ(1,"ion-label",14),n._uU(2),n.qZA(),n.TgZ(3,"div",15),n._uU(4),n.qZA(),n.qZA()),2&e){const o=s.$implicit,t=n.oxw(2);n.xp6(1),n.Q6J("ngStyle",n.VKq(4,B,"6px solid "+o.color)),n.xp6(1),n.hij(" ",o.name," "),n.xp6(1),n.Q6J("ngStyle",n.VKq(6,G,"6px solid "+o.color)),n.xp6(1),n.hij(" ",t.getPlayerTotalScores(o._id)," ")}}function z(e,s){if(1&e){const o=n.EpF();n.TgZ(0,"ion-card"),n.TgZ(1,"ion-card-header"),n.TgZ(2,"ion-card-title",10),n._uU(3,"Ticket to the ride"),n.qZA(),n.qZA(),n.TgZ(4,"ion-card-content"),n.TgZ(5,"ion-list"),n.YNc(6,E,5,8,"ion-item",11),n.qZA(),n.TgZ(7,"ion-row",12),n.TgZ(8,"ion-button",13),n.NdJ("click",function(){return n.CHM(o),n.oxw().onFinishGameHandler()}),n.ALo(9,"async"),n.ALo(10,"async"),n._uU(11),n.ALo(12,"translate"),n.qZA(),n.TgZ(13,"ion-button",13),n.NdJ("click",function(){return n.CHM(o),n.oxw().onCancelGameHandler()}),n.ALo(14,"async"),n.ALo(15,"async"),n._uU(16),n.ALo(17,"translate"),n.qZA(),n.qZA(),n.qZA(),n.qZA()}if(2&e){const o=n.oxw();n.xp6(6),n.Q6J("ngForOf",o.playersWithTotal),n.xp6(2),n.Q6J("disabled",0===n.lcZ(9,5,o.rounds$).length||n.lcZ(10,7,o.loading$)),n.xp6(3),n.hij(" ",n.lcZ(12,9,"elements.button.finishGame")," "),n.xp6(2),n.Q6J("disabled",0===n.lcZ(14,11,o.rounds$).length||n.lcZ(15,13,o.loading$)),n.xp6(3),n.hij(" ",n.lcZ(17,15,"elements.button.cancelGame")," ")}}const W=[{path:"",component:(()=>{class e{constructor(o,t,i,c,l){this.route=o,this.router=t,this.store=i,this.sharedService=c,this.gameService=l,this.roundsCfg=g.N.games.train.rounds,this.activeRound$=new $.X(this.roundsCfg[0])}ngOnInit(){this.loading$=this.store.select(q.NH),this.activeRound$.subscribe(o=>this.activeRound=o),this.rounds$=this.store.select(m.PK),this.rounds$.subscribe(o=>{this.rounds=o,o.length?"start"===this.activeRound._id&&this.activeRound$.next(this.roundsCfg[1]):"start"!==this.activeRound._id&&this.activeRound$.next(this.roundsCfg[0])}),this.roundMembers$=this.store.select(v.uW),this.players$=this.store.select(A.y1),this.players$.pipe((0,y.w)(o=>(this.players=o,this.roundMembers$))).subscribe(o=>{this.roundMembers=o,this.playersWithTotal=this.players.map(t=>Object.assign(Object.assign({},t),{totalScore:this.getPlayerTotalScores(t._id)})).sort((t,i)=>i.totalScore-t.totalScore)})}onMenuClickHandler(o){this.activeRound$.next(o.target.value)}onFinishGameHandler(){this.store.dispatch((0,p.V_)({loading:!0}));const o=this.rounds.map(c=>{const l=c.roundMembers.map(_=>{const C=this.roundMembers.find(T=>T._id===_);return{_id:C.player,score:C.scoresLine.reduce((T,nn)=>T+nn,0)}});return{_id:c._id,players:l}}),t={_id:"result",players:this.players.map(c=>({_id:c._id,score:this.getPlayerTotalScores(c._id)}))},i={type:this.rounds[0].clientGame.type,rounds:[...o,t]};this.gameService.add(i).subscribe(c=>{this.onCancelGameHandler()},c=>this.store.dispatch((0,p.V_)({loading:!1})))}onCancelGameHandler(){this.store.dispatch(p.GJ()),this.activeRound$.next(this.roundsCfg[0])}getPlayerTotalScores(o){return this.sharedService.getPlayerTotalScores(o,this.roundMembers)}}return e.\u0275fac=function(o){return new(o||e)(n.Y36(u.gz),n.Y36(u.F0),n.Y36(b.yh),n.Y36(M.F),n.Y36(R.h))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-train"]],decls:15,vars:6,consts:[["slot","end"],["menu","games-menu"],["scrollable","",3,"value","ionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"ion-no-margin","ion-no-padding"],["size-lg","6","size-md","8","size-sm","10","offset-lg","3","offset-md","2","offset-sm","1"],[4,"ngIf"],[3,"activeRound$"],[3,"value","disabled"],[3,"name"],[1,"ion-text-center"],[4,"ngFor","ngForOf"],[1,"ion-justify-content-around"],["fill","outline","size","small",3,"disabled","click"],[3,"ngStyle"],["slot","end",3,"ngStyle"]],template:function(o,t){1&o&&(n.TgZ(0,"ion-header"),n.TgZ(1,"ion-toolbar"),n.TgZ(2,"ion-buttons",0),n._UZ(3,"ion-menu-button",1),n.qZA(),n.TgZ(4,"ion-segment",2),n.NdJ("ionChange",function(c){return t.onMenuClickHandler(c)}),n.YNc(5,k,4,7,"ion-segment-button",3),n.qZA(),n.qZA(),n.qZA(),n.TgZ(6,"ion-content"),n.TgZ(7,"ion-grid",4),n.TgZ(8,"ion-row"),n.TgZ(9,"ion-col",5),n.YNc(10,z,18,17,"ion-card",6),n.ALo(11,"async"),n.qZA(),n.qZA(),n.TgZ(12,"ion-row"),n.TgZ(13,"ion-col",5),n._UZ(14,"app-train-rounds",7),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&o&&(n.xp6(4),n.Q6J("value",t.activeRound),n.xp6(1),n.Q6J("ngForOf",t.roundsCfg),n.xp6(5),n.Q6J("ngIf",0!==n.lcZ(11,4,t.rounds$).length),n.xp6(4),n.Q6J("activeRound$",t.activeRound$))},directives:[r.Gu,r.sr,r.Sm,r.fG,r.cJ,r.QI,d.sg,r.W2,r.jY,r.Nd,r.wI,d.O5,I,r.GO,r.gu,r.PM,r.Zi,r.Dq,r.FN,r.q_,r.YG,r.Ie,r.Q$,d.PC],pipes:[d.Ov,Z.X$],styles:[""]}),e})(),pathMatch:"full"},{path:"**",redirectTo:""}];let X=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[u.Bz.forChild(W)],u.Bz]}),e})();var D=a(6932),K=a(1173);let V=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[d.ez,f.u5,r.Pc,X,f.UX,K.D,Z.aw.forChild({extend:!0}),D.j]]}),e})()}}]);