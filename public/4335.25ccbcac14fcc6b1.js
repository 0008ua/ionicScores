"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4335],{4335:(so,x,a)=>{a.r(x),a.d(x,{TrainPageModule:()=>io});var _=a(6019),u=a(9133),i=a(4662),g=a(1880),q=a(4099),m=a(3783),p=a(8260),f=a(8761),C=a(3051),o=a(3668),y=a(607),v=a(6382),b=a(3093),J=a(5722),P=a(9204),h=a(4762);const w=function(t){return{"background-color":t}};function S(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-col",2),o.NdJ("click",function(){const s=o.CHM(e).$implicit;return o.oxw().onSelect(s)}),o._UZ(1,"div",3),o.qZA()}if(2&t){const e=c.$implicit;o.xp6(1),o.Q6J("ngStyle",o.VKq(1,w,e))}}let A=(()=>{class t{constructor(e){this.popoverController=e}ngOnInit(){}dismiss(e){this.popoverController.dismiss(e)}onSelect(e){this.dismiss({color:e})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(i.Dh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-select-color"]],inputs:{colors:"colors"},decls:5,vars:1,consts:[[1,"select-color"],["class","select-color__container",3,"click",4,"ngFor","ngForOf"],[1,"select-color__container",3,"click"],[1,"select-color__item",3,"ngStyle"]],template:function(e,n){1&e&&(o.TgZ(0,"ion-card"),o.TgZ(1,"ion-card-content"),o.TgZ(2,"ion-grid"),o.TgZ(3,"ion-row",0),o.YNc(4,S,2,3,"ion-col",1),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(4),o.Q6J("ngForOf",n.colors))},directives:[i.PM,i.FN,i.jY,i.Nd,_.sg,i.wI,_.PC],styles:[""]}),t})();var Z=a(3085);const $=function(t){return{"background-color":t}};let k=(()=>{class t{constructor(e){this.popoverController=e,this.playersColors=p.N.games.train.playersColors,this.color=this.playersColors[0]}ngOnInit(){}presentPopover(e,n,r){return(0,h.mG)(this,void 0,void 0,function*(){const s=yield this.popoverController.create({component:n,cssClass:"select-color-popover",componentProps:r,translucent:!0});return yield s.present(),yield s.onDidDismiss()})}showSelectColorPopup(e){return(0,h.mG)(this,void 0,void 0,function*(){const{data:n}=yield this.presentPopover(e,A,{colors:this.playersColors});if(n){const{color:r}=n;this.color=r}})}dismiss(e){this.popoverController.dismiss(e)}onCreate(){this.dismiss({gamer:{color:this.color,name:this.name}})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(i.Dh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-create-gamer"]],decls:23,vars:8,consts:[["slot","end"],[3,"click"],["lines","none"],[1,"choose-players"],[1,"choose-players__color"],[1,"select-color",3,"ngStyle","click"],[1,"choose-players__name"],["placeholder","Enter Name","clearInput","",3,"ngModel","ngModelChange"],["expand","block",3,"disabled","click"]],template:function(e,n){1&e&&(o.TgZ(0,"ion-header"),o.TgZ(1,"ion-toolbar"),o.TgZ(2,"ion-title"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"ion-buttons",0),o.TgZ(6,"ion-button",1),o.NdJ("click",function(){return n.dismiss()}),o._uU(7,"close"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(8,"ion-content"),o.TgZ(9,"ion-card"),o.TgZ(10,"ion-card-content"),o.TgZ(11,"ion-list"),o.TgZ(12,"ion-item",2),o.TgZ(13,"div",3),o.TgZ(14,"div",4),o.TgZ(15,"div",5),o.NdJ("click",function(s){return n.showSelectColorPopup(s)}),o.qZA(),o.qZA(),o.TgZ(16,"div",6),o.TgZ(17,"ion-item"),o.TgZ(18,"ion-input",7),o.NdJ("ngModelChange",function(s){return n.name=s}),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(19,"ion-row"),o.TgZ(20,"ion-col"),o.TgZ(21,"ion-button",8),o.NdJ("click",function(){return n.onCreate()}),o._uU(22,"create "),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(3),o.Oqu(o.lcZ(4,4,"modules.games.createGamer")),o.xp6(12),o.Q6J("ngStyle",o.VKq(6,$,n.color)),o.xp6(3),o.Q6J("ngModel",n.name),o.xp6(3),o.Q6J("disabled",!n.name))},directives:[i.Gu,i.sr,i.wd,i.Sm,i.YG,i.W2,i.PM,i.FN,i.q_,i.Ie,_.PC,i.pK,i.j9,u.JJ,u.On,i.Nd,i.wI],pipes:[Z.X$],styles:[""]}),t})();var T=a(5803),O=a(9973);function N(t,c){if(1&t&&(o.TgZ(0,"ion-select-option",12),o._uU(1),o.qZA()),2&t){const e=c.$implicit;o.Q6J("value",e),o.xp6(1),o.hij(" ",e.name," ")}}const F=function(t){return{"background-color":t}};function R(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-item-sliding",6),o.TgZ(1,"ion-item",6),o.TgZ(2,"div",7),o.TgZ(3,"div",8),o.TgZ(4,"div",9),o.NdJ("click",function(r){const l=o.CHM(e).index,d=o.oxw();return d.filtredColors.length?d.showSelectColorPopup(r,l):null}),o.qZA(),o.qZA(),o.TgZ(5,"div",10),o.TgZ(6,"ion-item"),o.TgZ(7,"ion-select",11),o.NdJ("ionChange",function(r){const l=o.CHM(e).index;return o.oxw().choosePlayerHandler(r,l)}),o.TgZ(8,"ion-select-option",12),o._uU(9),o.qZA(),o.YNc(10,N,2,2,"ion-select-option",13),o.qZA(),o.TgZ(11,"ion-note",14),o._UZ(12,"ion-icon",15),o._UZ(13,"ion-icon",16),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(14,"ion-item-options",17),o.TgZ(15,"ion-item-option",18),o.NdJ("click",function(){const s=o.CHM(e).$implicit;return o.oxw().removePlayerHandler(s._id)}),o._uU(16,"Remove"),o.qZA(),o.qZA(),o.qZA()}if(2&t){const e=c.$implicit,n=o.oxw();o.xp6(4),o.Q6J("ngStyle",o.VKq(5,F,null==e?null:e.color)),o.xp6(3),o.Q6J("value",e),o.xp6(1),o.Q6J("value",e),o.xp6(1),o.hij(" ",e.name," "),o.xp6(1),o.Q6J("ngForOf",n.filtredGamers)}}let Q=(()=>{class t{constructor(e,n,r,s,l,d){this.store=e,this.translate=n,this.gamerService=r,this.popoverController=s,this.alertController=l,this.sharedService=d,this.gamers=[],this.filtredGamers=[],this.players=[],this.playersColors=p.N.games.train.playersColors,this.filtredColors=p.N.games.train.playersColors}ngOnInit(){this.players$=this.store.select(C.y1),this.players$.subscribe(e=>{this.players=e,this.filter()}),this.gamers$=this.gamerService.entities$,this.gamers$.subscribe(e=>{this.gamers=e,this.filter()})}startGameHandler(){this.sharedService.createRounds("train")}presentPopover(e,n,r){return(0,h.mG)(this,void 0,void 0,function*(){const s=yield this.popoverController.create({component:n,cssClass:"select-color-popover",componentProps:r,translucent:!0});return yield s.present(),yield s.onDidDismiss()})}showSelectColorPopup(e,n){return(0,h.mG)(this,void 0,void 0,function*(){const{data:r}=yield this.presentPopover(e,A,{colors:this.filtredColors});if(r){const{color:s}=r;this.chooseColorHandler(s,n)}})}showCreateGamerPopup(e){return(0,h.mG)(this,void 0,void 0,function*(){const{data:n}=yield this.presentPopover(e,k,null);if(n){const{gamer:r}=n;console.log("gamer",n),this.createGamerHandler(r)}})}filter(){this.filtredGamers=this.gamers.filter(e=>{for(const n of this.players)if(n._id===e._id)return!1;return!0}),this.filtredColors=this.playersColors.filter(e=>{for(const n of this.players)if(n.color===e)return!1;return!0})}choosePlayerHandler(e,n){const r=this.players.map((s,l)=>l===n?this.filtredColors.includes(this.filtredGamers[0].color)?e.target.value:Object.assign(Object.assign({},e.target.value),{color:this.filtredColors[0]}):s);console.log("players",r),this.store.dispatch(T.K9({players:r}))}chooseColorHandler(e,n){this.players=this.players.map((r,s)=>s===n?Object.assign(Object.assign({},r),{color:e}):r),this.filter()}removePlayerHandler(e){this.store.dispatch(T.WQ({id:e}))}removeAllPlayersHandler(){this.store.dispatch(T.dO())}addPlayerHandler(e=!0){if(!this.filtredGamers.length)return;let n=this.filtredGamers[0];e||(n=this.filtredGamers[this.filtredGamers.length-1]),this.filtredColors.includes(n.color)?this.store.dispatch(T.KM({player:Object.assign({},n)})):this.store.dispatch(T.KM({player:Object.assign(Object.assign({},n),{color:this.filtredColors[0]})}))}createGamerHandler(e){this.gamerService.add(e).subscribe(n=>{console.log(n)})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(y.yh),o.Y36(Z.sK),o.Y36(O.E),o.Y36(i.Dh),o.Y36(i.Br),o.Y36(v.F))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-choose-players"]],decls:25,vars:9,consts:[[1,"ion-text-center"],["lines","none",4,"ngFor","ngForOf"],["expand","block","color","success",3,"disabled","click"],["expand","block","color","secondary",3,"disabled","click"],["expand","block","color","danger",3,"click"],["expand","block",3,"disabled","click"],["lines","none"],[1,"choose-players"],[1,"choose-players__color"],[1,"select-color",3,"ngStyle","click"],[1,"choose-players__name"],["placeholder","Select One","interface","popover","slot","end",3,"value","ionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["slot","end","color","danger"],["name","trash-outline"],["name","caret-back-outline"],["side","end"],["color","danger",3,"click"]],template:function(e,n){1&e&&(o.TgZ(0,"ion-card"),o.TgZ(1,"ion-card-header"),o.TgZ(2,"ion-card-title",0),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"ion-card-subtitle",0),o._uU(6,"Ticket to the ride"),o.qZA(),o.qZA(),o.TgZ(7,"ion-card-content"),o.TgZ(8,"ion-list"),o.YNc(9,R,17,7,"ion-item-sliding",1),o.ALo(10,"async"),o.qZA(),o.TgZ(11,"ion-row"),o.TgZ(12,"ion-col"),o.TgZ(13,"ion-button",2),o.NdJ("click",function(){return n.addPlayerHandler()}),o._uU(14," add "),o.qZA(),o.qZA(),o.TgZ(15,"ion-col"),o.TgZ(16,"ion-button",3),o.NdJ("click",function(s){return n.showCreateGamerPopup(s)}),o._uU(17," create "),o.qZA(),o.qZA(),o.TgZ(18,"ion-col"),o.TgZ(19,"ion-button",4),o.NdJ("click",function(){return n.removeAllPlayersHandler()}),o._uU(20,"remove all "),o.qZA(),o.qZA(),o.qZA(),o.TgZ(21,"ion-row"),o.TgZ(22,"ion-col"),o.TgZ(23,"ion-button",5),o.NdJ("click",function(){return n.startGameHandler()}),o._uU(24,"start game "),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(3),o.Oqu(o.lcZ(4,5,"modules.games.addPlayers")),o.xp6(6),o.Q6J("ngForOf",o.lcZ(10,7,n.players$)),o.xp6(4),o.Q6J("disabled",n.players.length>=5),o.xp6(3),o.Q6J("disabled",n.players.length>=5),o.xp6(7),o.Q6J("disabled",n.players.length<2))},directives:[i.PM,i.Zi,i.Dq,i.tO,i.FN,i.q_,_.sg,i.Nd,i.wI,i.YG,i.td,i.Ie,_.PC,i.t9,i.QI,i.n0,i.uN,i.gu,i.IK,i.u8],pipes:[Z.X$,_.Ov],styles:[""]}),t})();function G(t,c){1&t&&o._UZ(0,"app-choose-players")}function U(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-col",12),o.TgZ(1,"ion-chip",13),o.NdJ("click",function(){const s=o.CHM(e).$implicit,l=o.oxw(2).$implicit,d=o.oxw(2);return d.addToScoresLine(l._id,s*d.inverse[l._id])}),o.TgZ(2,"ion-label"),o._uU(3),o.qZA(),o.qZA(),o.qZA()}if(2&t){const e=c.$implicit,n=o.oxw(2).$implicit,r=o.oxw(2);o.xp6(1),o.Q6J("color",e>19?"secondary":"warning"),o.xp6(2),o.Oqu(e*r.inverse[n._id])}}function M(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-col",12),o.TgZ(1,"ion-chip",17),o.NdJ("click",function(){const s=o.CHM(e).$implicit,l=o.oxw(2).$implicit;return o.oxw(2).removeFromScoresLine(l._id,s)}),o.TgZ(2,"ion-label"),o._uU(3),o.qZA(),o._UZ(4,"ion-icon",18),o.qZA(),o.qZA()}if(2&t){const e=c.$implicit;o.xp6(1),o.Q6J("color",e>19?"secondary":"warning"),o.xp6(2),o.Oqu(e)}}function H(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-card-content"),o.TgZ(1,"ion-row",10),o.YNc(2,U,4,2,"ion-col",11),o.TgZ(3,"ion-col",12),o.TgZ(4,"ion-chip",13),o.NdJ("click",function(){o.CHM(e);const r=o.oxw().$implicit;return o.oxw(2).inverseScore(r._id)}),o._UZ(5,"ion-icon",14),o._UZ(6,"ion-icon",15),o.qZA(),o.qZA(),o.qZA(),o.TgZ(7,"ion-row",16),o.YNc(8,M,5,2,"ion-col",11),o.qZA(),o.qZA()}if(2&t){const e=o.oxw().$implicit,n=o.oxw(2);o.xp6(2),o.Q6J("ngForOf",n.routeScoresEnv),o.xp6(2),o.Q6J("color","danger"),o.xp6(4),o.Q6J("ngForOf",null==e?null:e.scoresLine)}}function Y(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-card-content"),o.TgZ(1,"ion-row"),o.TgZ(2,"ion-col"),o.TgZ(3,"ion-item",19),o.TgZ(4,"ion-label"),o._uU(5,"Mark as longest"),o.qZA(),o.TgZ(6,"ion-toggle",20),o.NdJ("ionChange",function(r){o.CHM(e);const s=o.oxw().$implicit;return o.oxw(2).onMarkLongestHandler(r,s._id)}),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const e=o.oxw().$implicit;o.xp6(6),o.Q6J("checked",e.scoresLine.length)}}function L(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-card-content"),o.TgZ(1,"ion-row",10),o.TgZ(2,"ion-col",21),o.TgZ(3,"ion-label"),o._uU(4),o.qZA(),o.qZA(),o.TgZ(5,"ion-col",22),o.TgZ(6,"div",23),o.TgZ(7,"ion-button",24),o.NdJ("click",function(){o.CHM(e);const r=o.oxw().$implicit;return o.oxw(2).removeFromScoresLine(r._id,4)}),o._UZ(8,"ion-icon",14),o.qZA(),o.TgZ(9,"span",25),o._uU(10,"Stations"),o.qZA(),o.TgZ(11,"ion-button",26),o.NdJ("click",function(){o.CHM(e);const r=o.oxw().$implicit;return o.oxw(2).addToScoresLine(r._id,4)}),o._UZ(12,"ion-icon",15),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const e=o.oxw().$implicit,n=o.oxw(2);o.xp6(4),o.Oqu(3-n.calcScores(e.scoresLine)/4),o.xp6(3),o.Q6J("disabled",e.scoresLine.length<=0),o.xp6(4),o.Q6J("disabled",e.scoresLine.length>=3)}}function I(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-row",10),o.TgZ(1,"ion-col",21),o.TgZ(2,"ion-label"),o._uU(3),o.qZA(),o.qZA(),o.TgZ(4,"ion-col",22),o.TgZ(5,"div",23),o.TgZ(6,"ion-button",28),o.NdJ("click",function(){const s=o.CHM(e).$implicit,l=o.oxw(2).$implicit;return o.oxw(2).addToScoresLine(l._id,s.score)}),o._UZ(7,"ion-icon",14),o.qZA(),o.TgZ(8,"span",25),o._UZ(9,"ion-icon",29),o._uU(10),o.qZA(),o.TgZ(11,"ion-button",30),o.NdJ("click",function(){const s=o.CHM(e).$implicit,l=o.oxw(2).$implicit;return o.oxw(2).removeFromScoresLine(l._id,s.score)}),o._UZ(12,"ion-icon",15),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const e=c.$implicit,n=o.oxw(2).$implicit,r=o.oxw(2);o.xp6(3),o.Oqu(r.calcQtyOfArrItems(n._id,e.score)),o.xp6(7),o.hij(" ",e.qty,"")}}function j(t,c){if(1&t&&(o.TgZ(0,"ion-card-content"),o.YNc(1,I,13,2,"ion-row",27),o.qZA()),2&t){const e=o.oxw(3);o.xp6(1),o.Q6J("ngForOf",e.carsCfg)}}const E=function(t){return{"border-bottom":t}};function z(t,c){if(1&t&&(o.TgZ(0,"ion-card"),o.TgZ(1,"ion-card-header",3),o.TgZ(2,"ion-card-subtitle"),o.TgZ(3,"span",4),o._UZ(4,"ion-icon",5),o.TgZ(5,"span",6),o._uU(6),o.qZA(),o._UZ(7,"span",7),o.TgZ(8,"span"),o._uU(9),o.qZA(),o.qZA(),o.qZA(),o.TgZ(10,"ion-card-title",8),o._uU(11),o.qZA(),o.qZA(),o.YNc(12,H,9,3,"ion-card-content",9),o.YNc(13,Y,7,1,"ion-card-content",9),o.YNc(14,L,13,3,"ion-card-content",9),o.YNc(15,j,2,1,"ion-card-content",9),o.qZA()),2&t){const e=c.$implicit,n=o.oxw(2);o.xp6(1),o.Q6J("ngStyle",o.VKq(9,E,"2px solid "+n.getPlayerColor(e._id))),o.xp6(3),o.Q6J("name",null==n.activeRound?null:n.activeRound.icon),o.xp6(2),o.Oqu(null==n.activeRound?null:n.activeRound._id),o.xp6(3),o.Oqu(n.calcScores(e.scoresLine)),o.xp6(2),o.Oqu(n.getPlayerName(e._id)),o.xp6(1),o.Q6J("ngIf","routes"===n.round._id),o.xp6(1),o.Q6J("ngIf","length"===n.round._id),o.xp6(1),o.Q6J("ngIf","stations"===n.round._id),o.xp6(1),o.Q6J("ngIf","cars"===n.round._id)}}function K(t,c){if(1&t&&o.YNc(0,z,16,11,"ion-card",2),2&t){const e=o.oxw();o.Q6J("ngForOf",e.round.players)}}let D=(()=>{class t{constructor(e,n){this.route=e,this.store=n,this.roundsCfg=p.N.games.train.rounds,this.carsCfg=p.N.games.train.cars,this.routeScoresEnv=p.N.games.train.routeScores,this.inverse={}}ngOnInit(){this.activeRound$.pipe((0,J.b)(e=>this.activeRound=e),(0,P.w)(e=>this.store.select(f.G5(e._id)))).subscribe(e=>{console.log("round",e),e&&(this.round=e,this.round.players.forEach(n=>this.inverse[n._id]=1))}),this.rounds$=this.store.select(f.yh),this.rounds$.subscribe(e=>{this.rounds=e,console.log("rounds",e)}),this.players$=this.store.select(C.y1),this.players$.subscribe(e=>{this.players=e})}calcScores(e){return e.reduce((n,r)=>n+r,0)}getPlayerColor(e){return this.players.find(n=>n._id===e).color}getPlayerName(e){return this.players.find(n=>n._id===e).name}calcQtyOfArrItems(e,n){let r=0;return this.round.players.forEach(s=>{s._id===e&&s.scoresLine.forEach(l=>{l===n&&r++})}),r}inverseScore(e){this.inverse[e]=-1*this.inverse[e]}addToScoresLine(e,n){console.log("upd",n);const r=this.round.players.map(s=>s._id===e?Object.assign(Object.assign({},s),{scoresLine:[...s.scoresLine,n]}):s);this.store.dispatch(m.TK({round:{id:this.round._id,changes:{players:r}}}))}removeFromScoresLine(e,n){const r=this.round.players.map(s=>{if(s._id===e){const l=[...s.scoresLine],d=l.indexOf(n);if(l.splice(d,1),-1!==d)return Object.assign(Object.assign({},s),{scoresLine:l})}return s});this.store.dispatch(m.TK({round:{id:this.round._id,changes:{players:r}}}))}setScoresLine(e,n){const r=this.round.players.map(s=>s._id===e?Object.assign(Object.assign({},s),{scoresLine:n}):s);this.store.dispatch(m.TK({round:{id:this.round._id,changes:{players:r}}}))}onMarkLongestHandler(e,n){this.setScoresLine(n,e.target.checked?[10]:[])}onChangeStationsHandler(e){console.log("e-value",e.target.value)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(g.gz),o.Y36(y.yh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-train-rounds"]],inputs:{activeRound$:"activeRound$"},decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["restRounds",""],[4,"ngFor","ngForOf"],[3,"ngStyle"],[1,"round-subtitle"],["color","primary",1,"round-subtitle__icon",3,"name"],[1,"ion-text-capitalize"],[1,"round-subtitle__blank"],[1,"ion-text-center"],[4,"ngIf"],[1,"round","round_tools"],["size","3",4,"ngFor","ngForOf"],["size","3"],[3,"color","click"],["name","add-outline"],["name","remove-outline"],[1,"round","round_result"],["outline","",3,"color","click"],["name","close-circle"],["lines","none"],[3,"checked","ionChange"],[1,"round_tools__score"],[1,"round_tools__btn"],[1,"incDecBtn"],["shape","round","color","success",3,"disabled","click"],[1,"incDecBtn__caption"],["shape","round","color","warning",3,"disabled","click"],["class","round round_tools",4,"ngFor","ngForOf"],["shape","round","color","success",3,"click"],["name","train-outline"],["shape","round","color","warning",3,"click"]],template:function(e,n){if(1&e&&(o.YNc(0,G,1,0,"app-choose-players",0),o.ALo(1,"async"),o.YNc(2,K,1,1,"ng-template",null,1,o.W1O)),2&e){const r=o.MAs(3);o.Q6J("ngIf","start"===(null==n.activeRound?null:n.activeRound._id)&&0===o.lcZ(1,2,n.rounds$).length)("ngIfElse",r)}},directives:[_.O5,Q,_.sg,i.PM,i.Zi,_.PC,i.tO,i.gu,i.Dq,i.FN,i.Nd,i.wI,i.hM,i.Q$,i.Ie,i.ho,i.w,i.YG],pipes:[_.Ov],styles:[""]}),t})();function B(t,c){if(1&t&&(o.TgZ(0,"ion-segment-button",8),o.ALo(1,"async"),o.ALo(2,"async"),o._UZ(3,"ion-icon",9),o.qZA()),2&t){const e=c.$implicit,n=o.oxw();o.Q6J("value",e)("disabled","start"===e._id&&o.lcZ(1,3,n.rounds$).length||"start"!==e._id&&0===o.lcZ(2,5,n.rounds$).length),o.xp6(3),o.Q6J("name",e.icon)}}const X=function(t){return{"border-left":t,"padding-left":"10px"}},V=function(t){return{"border-right":t,"padding-right":"10px"}};function W(t,c){if(1&t&&(o.TgZ(0,"ion-item"),o.TgZ(1,"ion-label",14),o._uU(2),o.qZA(),o.TgZ(3,"div",15),o._uU(4),o.qZA(),o.qZA()),2&t){const e=c.$implicit,n=o.oxw(2);o.xp6(1),o.Q6J("ngStyle",o.VKq(4,X,"6px solid "+e.color)),o.xp6(1),o.hij(" ",e.name," "),o.xp6(1),o.Q6J("ngStyle",o.VKq(6,V,"6px solid "+e.color)),o.xp6(1),o.hij(" ",n.getPlayerTotalScores(e._id)," ")}}function oo(t,c){if(1&t){const e=o.EpF();o.TgZ(0,"ion-card"),o.TgZ(1,"ion-card-header"),o.TgZ(2,"ion-card-title",10),o._uU(3,"Ticket to the ride"),o.qZA(),o.qZA(),o.TgZ(4,"ion-card-content"),o.TgZ(5,"ion-list"),o.YNc(6,W,5,8,"ion-item",11),o.ALo(7,"async"),o.qZA(),o.TgZ(8,"ion-row",12),o.TgZ(9,"ion-col"),o.TgZ(10,"ion-button",13),o.NdJ("click",function(){return o.CHM(e),o.oxw().onFinishGameHandler()}),o.ALo(11,"async"),o._uU(12,"finish game "),o.qZA(),o.qZA(),o.TgZ(13,"ion-col"),o.TgZ(14,"ion-button",13),o.NdJ("click",function(){return o.CHM(e),o.oxw().onCancelGameHandler()}),o.ALo(15,"async"),o._uU(16,"cancel game "),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const e=o.oxw();o.xp6(6),o.Q6J("ngForOf",o.lcZ(7,3,e.players$)),o.xp6(4),o.Q6J("disabled",0===o.lcZ(11,5,e.rounds$).length),o.xp6(4),o.Q6J("disabled",0===o.lcZ(15,7,e.rounds$).length)}}const eo=[{path:"",component:(()=>{class t{constructor(e,n,r,s,l){this.route=e,this.router=n,this.store=r,this.sharedService=s,this.gameService=l,this.roundsCfg=p.N.games.train.rounds,this.activeRound$=new q.X(this.roundsCfg[0])}ngOnInit(){this.activeRound$.subscribe(e=>this.activeRound=e),this.rounds$=this.store.select(f.yh),this.rounds$.subscribe(e=>{this.rounds=e,e.length?"start"===this.activeRound._id&&this.activeRound$.next(this.roundsCfg[1]):"start"!==this.activeRound._id&&this.activeRound$.next(this.roundsCfg[0])}),this.players$=this.store.select(C.y1),this.players$.subscribe(e=>{this.players=e})}onMenuClickHandler(e){this.activeRound$.next(e.target.value)}onFinishGameHandler(){const e=this.rounds.map(r=>{const s=r.players.map(l=>({_id:l._id,score:l.scoresLine.reduce((d,ro)=>d+ro,0)}));return Object.assign(Object.assign({},r),{players:s})});this.gameService.add({type:this.rounds[0].clientGame.type,rounds:e}).subscribe(r=>{console.log(r),this.store.dispatch((0,m.Tz)())})}onCancelGameHandler(){this.store.dispatch((0,m.Tz)())}getPlayerTotalScores(e){let n=0;return this.rounds.forEach(r=>{r.players.forEach(s=>{s._id===e&&(n+=s.scoresLine.reduce((l,d)=>l+d,0))})}),n}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(g.gz),o.Y36(g.F0),o.Y36(y.yh),o.Y36(v.F),o.Y36(b.h))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-train"]],decls:17,vars:6,consts:[["slot","end"],["menu","games-menu"],["scrollable","",3,"value","ionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"ion-no-margin","ion-no-padding"],["size-lg","6","size-md","8","size-sm","10","offset-lg","3","offset-md","2","offset-sm","1"],[4,"ngIf"],[3,"activeRound$"],[3,"value","disabled"],[3,"name"],[1,"ion-text-center"],[4,"ngFor","ngForOf"],[1,"ion-justify-content-around"],["expand","block","size","small",3,"disabled","click"],[3,"ngStyle"],["slot","end",3,"ngStyle"]],template:function(e,n){1&e&&(o.TgZ(0,"ion-header"),o.TgZ(1,"ion-toolbar"),o.TgZ(2,"ion-title"),o._uU(3,"train"),o.qZA(),o.TgZ(4,"ion-buttons",0),o._UZ(5,"ion-menu-button",1),o.qZA(),o.TgZ(6,"ion-segment",2),o.NdJ("ionChange",function(s){return n.onMenuClickHandler(s)}),o.YNc(7,B,4,7,"ion-segment-button",3),o.qZA(),o.qZA(),o.qZA(),o.TgZ(8,"ion-content"),o.TgZ(9,"ion-grid",4),o.TgZ(10,"ion-row"),o.TgZ(11,"ion-col",5),o.YNc(12,oo,17,9,"ion-card",6),o.ALo(13,"async"),o.qZA(),o.qZA(),o.TgZ(14,"ion-row"),o.TgZ(15,"ion-col",5),o._UZ(16,"app-train-rounds",7),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(6),o.Q6J("value",n.activeRound),o.xp6(1),o.Q6J("ngForOf",n.roundsCfg),o.xp6(5),o.Q6J("ngIf",0!==o.lcZ(13,4,n.rounds$).length),o.xp6(4),o.Q6J("activeRound$",n.activeRound$))},directives:[i.Gu,i.sr,i.wd,i.Sm,i.fG,i.cJ,i.QI,_.sg,i.W2,i.jY,i.Nd,i.wI,_.O5,D,i.GO,i.gu,i.PM,i.Zi,i.Dq,i.FN,i.q_,i.YG,i.Ie,i.Q$,_.PC],pipes:[_.Ov],styles:[""]}),t})(),pathMatch:"full"},{path:"**",redirectTo:""}];let no=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[g.Bz.forChild(eo)],g.Bz]}),t})(),to=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[u.u5,_.ez,i.Pc,Z.aw.forChild({extend:!0})]]}),t})(),io=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[_.ez,u.u5,i.Pc,no,u.UX,Z.aw.forChild({extend:!0}),to]]}),t})()}}]);