"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8477],{8477:(be,S,a)=>{a.r(S),a.d(S,{GamePageModule:()=>Se});var d=a(6019),g=a(9133),r=a(4662),C=a(777),q=a(466),w=a(2668),u=a(8260),h=a(5305),b=a(8761),P=a(3051),J=a(7539),L=a(9204),T=a(8717),e=a(3668),f=a(607),v=a(6382),F=a(3093),Z=a(4762);const O=function(n){return{"background-color":n}};function G(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-col",2),e.NdJ("click",function(){const c=e.CHM(o).$implicit;return e.oxw().onSelect(c)}),e._UZ(1,"div",3),e.qZA()}if(2&n){const o=s.$implicit;e.xp6(1),e.Q6J("ngStyle",e.VKq(1,O,o))}}let R=(()=>{class n{constructor(o){this.popoverController=o}ngOnInit(){}dismiss(o){this.popoverController.dismiss(o)}onSelect(o){this.dismiss({color:o})}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(r.Dh))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-select-color"]],inputs:{colors:"colors"},decls:5,vars:1,consts:[[1,"select-color"],["class","select-color__container",3,"click",4,"ngFor","ngForOf"],[1,"select-color__container",3,"click"],[1,"select-color__item",3,"ngStyle"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-card"),e.TgZ(1,"ion-card-content"),e.TgZ(2,"ion-grid"),e.TgZ(3,"ion-row",0),e.YNc(4,G,2,3,"ion-col",1),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(4),e.Q6J("ngForOf",t.colors))},directives:[r.PM,r.FN,r.jY,r.Nd,d.sg,r.wI,d.PC],styles:[""]}),n})();var p=a(3085);const k=function(n){return{"background-color":n}};let Q=(()=>{class n{constructor(o){this.popoverController=o,this.playersColors=u.N.games.train.playersColors,this.color=this.playersColors[0]}ngOnInit(){}presentPopover(o,t,i){return(0,Z.mG)(this,void 0,void 0,function*(){const c=yield this.popoverController.create({component:t,cssClass:"select-color-popover",componentProps:i,translucent:!0});return yield c.present(),yield c.onDidDismiss()})}showSelectColorPopup(o){return(0,Z.mG)(this,void 0,void 0,function*(){const{data:t}=yield this.presentPopover(o,R,{colors:this.playersColors});if(t){const{color:i}=t;this.color=i}})}dismiss(o){this.popoverController.dismiss(o)}onCreate(){this.dismiss({gamer:{color:this.color,name:this.name}})}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(r.Dh))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-create-gamer"]],decls:26,vars:17,consts:[["slot","end"],[3,"click"],["lines","none"],[1,"players-list"],[1,"players-list__color"],[1,"select-color",3,"ngStyle","click"],[1,"players-list__name"],["clearInput","",3,"placeholder","ngModel","ngModelChange"],["expand","block",3,"disabled","click"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-title"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-buttons",0),e.TgZ(6,"ion-button",1),e.NdJ("click",function(){return t.dismiss()}),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"ion-content"),e.TgZ(10,"ion-card"),e.TgZ(11,"ion-card-content"),e.TgZ(12,"ion-list"),e.TgZ(13,"ion-item",2),e.TgZ(14,"div",3),e.TgZ(15,"div",4),e.TgZ(16,"div",5),e.NdJ("click",function(c){return t.showSelectColorPopup(c)}),e.qZA(),e.qZA(),e.TgZ(17,"div",6),e.TgZ(18,"ion-item"),e.TgZ(19,"ion-input",7),e.NdJ("ngModelChange",function(c){return t.name=c}),e.ALo(20,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(21,"ion-row"),e.TgZ(22,"ion-col"),e.TgZ(23,"ion-button",8),e.NdJ("click",function(){return t.onCreate()}),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Oqu(e.lcZ(4,7,"modules.games.createGamer")),e.xp6(4),e.hij(" ",e.lcZ(8,9,"elements.button.close")," "),e.xp6(9),e.Q6J("ngStyle",e.VKq(15,k,t.color)),e.xp6(3),e.Q6J("placeholder",e.lcZ(20,11,"modules.user.name"))("ngModel",t.name),e.xp6(4),e.Q6J("disabled",!t.name),e.xp6(1),e.hij(" ",e.lcZ(25,13,"elements.button.create")," "))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.YG,r.W2,r.PM,r.FN,r.q_,r.Ie,d.PC,r.pK,r.j9,g.JJ,g.On,r.Nd,r.wI],pipes:[p.X$],styles:[""]}),n})();var y=a(5803),M=a(9973);function U(n,s){if(1&n&&(e.TgZ(0,"ion-select-option",15),e._uU(1),e.qZA()),2&n){const o=s.$implicit;e.Q6J("value",o),e.xp6(1),e.hij(" ",o.name," ")}}const Y=function(n){return{"background-color":n}};function H(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-item-sliding",9),e.TgZ(1,"ion-item",9),e.TgZ(2,"div",10),e.TgZ(3,"div",11),e.TgZ(4,"div",12),e.NdJ("click",function(i){const l=e.CHM(o).index,m=e.oxw();return m.filtredColors.length>1?m.showSelectColorPopup(i,l):null}),e.qZA(),e.qZA(),e.TgZ(5,"div",13),e.TgZ(6,"ion-item"),e.TgZ(7,"ion-select",14),e.NdJ("ionChange",function(i){const l=e.CHM(o).index;return e.oxw().choosePlayerHandler(i,l)}),e.TgZ(8,"ion-select-option",15),e._uU(9),e.qZA(),e.YNc(10,U,2,2,"ion-select-option",16),e.qZA(),e.TgZ(11,"ion-note",17),e._UZ(12,"ion-icon",18),e._UZ(13,"ion-icon",19),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"ion-item-options",20),e.TgZ(15,"ion-item-option",21),e.NdJ("click",function(){const c=e.CHM(o).$implicit;return e.oxw().removePlayerHandler(c._id)}),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.qZA(),e.qZA()}if(2&n){const o=s.$implicit,t=e.oxw();e.xp6(4),e.Q6J("ngStyle",e.VKq(8,Y,null==o?null:o.color)),e.xp6(3),e.Q6J("value",o),e.xp6(1),e.Q6J("value",o),e.xp6(1),e.hij(" ",o.name," "),e.xp6(1),e.Q6J("ngForOf",t.filtredGamers),e.xp6(6),e.Oqu(e.lcZ(17,6,"elements.button.remove"))}}let j=(()=>{class n{constructor(o,t,i,c,l,m){this.store=o,this.translate=t,this.gamerService=i,this.popoverController=c,this.alertController=l,this.sharedService=m,this.environment=u.N,this.gamers=[],this.filtredGamers=[],this.players=[]}ngOnInit(){this.gameType$=this.store.select(h.Wn),this.gameType$.subscribe(o=>{var t,i;this.gameType=o,this.playersColors=null===(t=u.N.games[o])||void 0===t?void 0:t.playersColors,this.filtredColors=null===(i=u.N.games[o])||void 0===i?void 0:i.playersColors}),this.players$=this.store.select(P.y1),this.players$.subscribe(o=>{this.players=o,this.filter()}),this.gamers$=this.gamerService.entities$,this.gamers$.subscribe(o=>{this.gamers=o,this.filter()})}startGameHandler(){this.sharedService.createRounds(this.gameType)}presentPopover(o,t,i){return(0,Z.mG)(this,void 0,void 0,function*(){const c=yield this.popoverController.create({component:t,cssClass:"select-color-popover",componentProps:i,translucent:!0});return yield c.present(),yield c.onDidDismiss()})}showSelectColorPopup(o,t){return(0,Z.mG)(this,void 0,void 0,function*(){const{data:i}=yield this.presentPopover(o,R,{colors:this.filtredColors});if(i){const{color:c}=i;this.chooseColorHandler(c,t)}})}showCreateGamerPopup(o){return(0,Z.mG)(this,void 0,void 0,function*(){const{data:t}=yield this.presentPopover(o,Q,null);if(t){const{gamer:i}=t;console.log("gamer",t),this.createGamerHandler(i)}})}filter(){var o;this.filtredGamers=this.gamers.filter(i=>{for(const c of this.players)if(c._id===i._id)return!1;return!0});const t=null===(o=this.playersColors)||void 0===o?void 0:o.filter((i,c)=>{for(const l of this.players)if(l.color===i)return!1;return!0});this.filtredColors=(null==t?void 0:t.length)?t:this.filtredColors}choosePlayerHandler(o,t){const i=this.players.map((c,l)=>l===t?this.filtredColors.includes(this.filtredGamers[0].color)?o.target.value:Object.assign(Object.assign({},o.target.value),{color:this.filtredColors[0]}):c);this.store.dispatch(y.K9({players:i}))}chooseColorHandler(o,t){this.players=this.players.map((i,c)=>c===t?Object.assign(Object.assign({},i),{color:o}):i),this.filter()}removePlayerHandler(o){this.store.dispatch(y.WQ({id:o}))}removeAllPlayersHandler(){this.store.dispatch(y.dO())}addPlayerHandler(o=!0){if(!this.filtredGamers.length)return;let t=this.filtredGamers[0];o||(t=this.filtredGamers[this.filtredGamers.length-1]),this.filtredColors.includes(t.color)?this.store.dispatch(y.KM({player:Object.assign({},t)})):this.store.dispatch(y.KM({player:Object.assign(Object.assign({},t),{color:this.filtredColors[0]})}))}createGamerHandler(o){this.gamerService.add(o).subscribe(t=>{console.log(t)})}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(f.yh),e.Y36(p.sK),e.Y36(M.E),e.Y36(r.Dh),e.Y36(r.Br),e.Y36(v.F))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-choose-players"]],decls:29,vars:22,consts:[[1,"ion-text-center"],[1,"choose-players"],[1,"choose-players__list"],["lines","none",4,"ngFor","ngForOf"],[1,"choose-players__btn-block"],["expand","block","fill","outline","size","small","color","secondary",3,"disabled","click"],["expand","block","fill","outline","size","small","color","success",3,"disabled","click"],["expand","block","fill","outline","size","small","color","danger",3,"click"],["expand","block",3,"disabled","click"],["lines","none"],[1,"players-list"],[1,"players-list__color"],[1,"select-color",3,"ngStyle","click"],[1,"players-list__name"],["placeholder","Select One","interface","popover","slot","end",3,"value","ionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["slot","end","color","danger"],["name","trash-outline"],["name","caret-back-outline"],["side","end"],["color","danger",3,"click"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-card"),e.TgZ(1,"ion-card-header"),e.TgZ(2,"ion-card-title",0),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-card-subtitle",0),e._uU(6),e.qZA(),e.qZA(),e.TgZ(7,"ion-card-content",1),e.TgZ(8,"ion-list",2),e.YNc(9,H,18,10,"ion-item-sliding",3),e.ALo(10,"async"),e.qZA(),e.TgZ(11,"ion-row",4),e.TgZ(12,"ion-col"),e.TgZ(13,"ion-button",5),e.NdJ("click",function(){return t.addPlayerHandler()}),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.qZA(),e.TgZ(16,"ion-col"),e.TgZ(17,"ion-button",6),e.NdJ("click",function(c){return t.showCreateGamerPopup(c)}),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.qZA(),e.TgZ(20,"ion-col"),e.TgZ(21,"ion-button",7),e.NdJ("click",function(){return t.removeAllPlayersHandler()}),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(24,"ion-row",4),e.TgZ(25,"ion-col"),e.TgZ(26,"ion-button",8),e.NdJ("click",function(){return t.startGameHandler()}),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Oqu(e.lcZ(4,10,"modules.games.addPlayers")),e.xp6(3),e.Oqu(null==t.environment.games[t.gameType]?null:t.environment.games[t.gameType].name),e.xp6(3),e.Q6J("ngForOf",e.lcZ(10,12,t.players$)),e.xp6(4),e.Q6J("disabled",t.players.length>=5),e.xp6(1),e.hij(" ",e.lcZ(15,14,"elements.button.add")," "),e.xp6(3),e.Q6J("disabled",t.players.length>=5),e.xp6(1),e.hij(" ",e.lcZ(19,16,"elements.button.create")," "),e.xp6(4),e.hij(" ",e.lcZ(23,18,"elements.button.removeAll")," "),e.xp6(4),e.Q6J("disabled",t.players.length<2),e.xp6(1),e.hij(" ",e.lcZ(28,20,"elements.button.startGame")," "))},directives:[r.PM,r.Zi,r.Dq,r.tO,r.FN,r.q_,d.sg,r.Nd,r.wI,r.YG,r.td,r.Ie,d.PC,r.t9,r.QI,r.n0,r.uN,r.gu,r.IK,r.u8],pipes:[p.X$,d.Ov],styles:[""]}),n})();const _=new e.OlP("roundComponent"),B=function(n){return{"border-bottom":n}},z=["*"];let E=(()=>{class n{constructor(o,t){this.sharedService=o,this.store=t}ngOnInit(){this.loading$=this.store.select(h.NH),this.gameType$=this.store.select(h.Wn),this.gameType$.subscribe(o=>this.gameType=o)}getRoundById(){return this.sharedService.getRoundById(this.roundId)}calcScores(){var o;return null===(o=this.getMemberByPlayerId())||void 0===o?void 0:o.scoresLine.reduce((t,i)=>t+i,0)}getPlayerColor(){return this.sharedService.getPlayerColor(this.playerId)}getPlayerName(){return this.sharedService.getPlayerName(this.playerId)}getMemberByPlayerId(){return this.sharedService.getMemberByPlayerId(this.playerId,this.roundId)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(v.F),e.Y36(f.yh))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-round-wrapper"]],contentQueries:function(o,t,i){if(1&o&&e.Suo(i,_,7),2&o){let c;e.iGM(c=e.CRH())&&(t.roundComponent=c.first)}},inputs:{playerId:"playerId",roundId:"roundId"},ngContentSelectors:z,decls:15,vars:12,consts:[[3,"ngStyle"],[1,"round-subtitle"],["color","primary",1,"round-subtitle__icon",3,"name"],[1,"ion-text-capitalize","round-subtitle__text"],[1,"round-subtitle__blank"],[1,"ion-text-center"]],template:function(o,t){if(1&o&&(e.F$t(),e.TgZ(0,"ion-card"),e.TgZ(1,"ion-card-header",0),e.TgZ(2,"ion-card-subtitle"),e.TgZ(3,"span",1),e._UZ(4,"ion-icon",2),e.TgZ(5,"span",3),e._uU(6),e.ALo(7,"translate"),e.ALo(8,"async"),e.qZA(),e._UZ(9,"span",4),e.TgZ(10,"span"),e._uU(11),e.qZA(),e.qZA(),e.qZA(),e.TgZ(12,"ion-card-title",5),e._uU(13),e.qZA(),e.qZA(),e.Hsn(14),e.qZA()),2&o){let i,c;e.xp6(1),e.Q6J("ngStyle",e.VKq(10,B,"2px solid "+t.getPlayerColor())),e.xp6(3),e.Q6J("name",null==(i=t.getRoundById())?null:i.icon),e.xp6(2),e.AsE(" ",e.lcZ(7,6,"games."+e.lcZ(8,8,t.gameType$)+"."+(null==(c=t.getRoundById())?null:c.name))," ",null==(c=t.getRoundById())?null:c.namePostfix," "),e.xp6(5),e.Oqu(t.calcScores()),e.xp6(2),e.Oqu(t.getPlayerName())}},directives:[r.PM,r.Zi,d.PC,r.tO,r.gu,r.Dq],pipes:[p.X$,d.Ov],styles:[""]}),n})(),x=(()=>{class n{constructor(o){this.sharedService=o.get(v.F)}getMemberByPlayerId(){return this.sharedService.getMemberByPlayerId(this.playerId,this.roundId)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(e.zs3))},n.\u0275dir=e.lG2({type:n,selectors:[["","appRound",""]],inputs:{playerId:"playerId",roundId:"roundId"}}),n})(),A=(()=>{class n extends x{constructor(o){super(o)}addToScoresLine(o){this.sharedService.addToScoresLine(o,this.playerId,this.roundId)}removeFromScoresLine(o){this.sharedService.removeFromScoresLine(o,this.playerId,this.roundId)}addToNamedScoresLine(o){this.sharedService.addToNamedScoresLine(o,this.playerId,this.roundId)}removeFromNamedScoresLine(o){this.sharedService.removeFromNamedScoresLine(o,this.playerId,this.roundId)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(e.zs3))},n.\u0275dir=e.lG2({type:n,selectors:[["","appRoundScoresLine",""]],features:[e.qOj]}),n})();function D(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-col",2),e.TgZ(1,"ion-chip",3),e.NdJ("click",function(){const c=e.CHM(o).$implicit,l=e.oxw();return l.addToNamedScoresLine({value:c.value*l.inverse,name:l.numberFn(c.name)*l.inverse+""})}),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e.qZA(),e.qZA()}if(2&n){const o=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("color",o.value>19?"secondary":"warning"),e.xp6(2),e.Oqu(o.value*t.inverse)}}function X(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-col",2),e.TgZ(1,"ion-chip",7),e.NdJ("click",function(){const c=e.CHM(o).$implicit;return e.oxw().removeFromNamedScoresLine({value:c.value,name:c.name})}),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e._UZ(4,"ion-icon",8),e.qZA(),e.qZA()}if(2&n){const o=s.$implicit;e.xp6(1),e.Q6J("color",o.value>19?"secondary":"warning"),e.xp6(2),e.Oqu(o.value)}}let W=(()=>{class n extends A{constructor(o){super(o),this.routesScoresEnv=u.N.games.train.routesScores,this.inverse=1,this.numberFn=Number}ngOnInit(){}inverseScore(){this.inverse=-1*this.inverse}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(e.zs3))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-round-routes"]],inputs:{playerId:"playerId",roundId:"roundId"},features:[e._Bn([{provide:_,useExisting:n}]),e.qOj],decls:9,vars:3,consts:[[1,"round","round_tools"],["size","3",4,"ngFor","ngForOf"],["size","3"],[3,"color","click"],["name","add-outline"],["name","remove-outline"],[1,"round","round_result"],["outline","",3,"color","click"],["name","close-circle"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-card-content"),e.TgZ(1,"ion-row",0),e.YNc(2,D,4,2,"ion-col",1),e.TgZ(3,"ion-col",2),e.TgZ(4,"ion-chip",3),e.NdJ("click",function(){return t.inverseScore()}),e._UZ(5,"ion-icon",4),e._UZ(6,"ion-icon",5),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"ion-row",6),e.YNc(8,X,5,2,"ion-col",1),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Q6J("ngForOf",t.routesScoresEnv),e.xp6(2),e.Q6J("color","danger"),e.xp6(4),e.Q6J("ngForOf",t.getMemberByPlayerId().namedScoresLine))},directives:[r.FN,r.Nd,d.sg,r.wI,r.hM,r.gu,r.Q$],styles:[""]}),n})(),K=(()=>{class n extends x{constructor(o){super(o),this.longestRouteScoreEnv=u.N.games.train.longestRouteScore}ngOnInit(){}onMarkLongestHandler(o){this.sharedService.setScoresLine(o.target.checked?[this.longestRouteScoreEnv]:[],this.playerId,this.roundId)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(e.zs3))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-round-length"]],features:[e._Bn([{provide:_,useExisting:n}]),e.qOj],decls:7,vars:4,consts:[[1,"round","round_tools"],[3,"checked","ionChange"]],template:function(o,t){if(1&o&&(e.TgZ(0,"ion-card-content"),e.TgZ(1,"ion-row"),e.TgZ(2,"ion-col",0),e.TgZ(3,"div"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"ion-toggle",1),e.NdJ("ionChange",function(c){return t.onMarkLongestHandler(c)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o){let i;e.xp6(4),e.Oqu(e.lcZ(5,2,"games.train.longestRoute")),e.xp6(2),e.Q6J("checked",null==(i=t.getMemberByPlayerId())?null:i.scoresLine.length)}},directives:[r.FN,r.Nd,r.wI,r.ho,r.w],pipes:[p.X$],styles:[""]}),n})(),V=(()=>{class n extends x{constructor(o){super(o)}ngOnInit(){}addToScoresLine(o){this.sharedService.addToScoresLine(o,this.playerId,this.roundId)}removeFromScoresLine(o){this.sharedService.removeFromScoresLine(o,this.playerId,this.roundId)}calcScores(){return this.getMemberByPlayerId().scoresLine.reduce((o,t)=>o+t,0)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(e.zs3))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-round-stations"]],features:[e._Bn([{provide:_,useExisting:n}]),e.qOj],decls:15,vars:6,consts:[[1,"round","round_tools"],[1,"round_tools__score"],[1,"round_tools__btn"],[1,"incDecBtn"],["shape","round","color","danger","fill","outline",3,"disabled","click"],["name","remove-outline"],[1,"incDecBtn__caption"],["shape","round","color","success","fill","outline",3,"disabled","click"],["name","add-outline"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-card-content"),e.TgZ(1,"ion-row",0),e.TgZ(2,"ion-col",1),e.TgZ(3,"ion-label"),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"ion-col",2),e.TgZ(6,"div",3),e.TgZ(7,"ion-button",4),e.NdJ("click",function(){return t.addToScoresLine(4)}),e._UZ(8,"ion-icon",5),e.qZA(),e.TgZ(9,"span",6),e.TgZ(10,"div"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.qZA(),e.TgZ(13,"ion-button",7),e.NdJ("click",function(){return t.removeFromScoresLine(4)}),e._UZ(14,"ion-icon",8),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(4),e.Oqu(3-t.calcScores()/4),e.xp6(3),e.Q6J("disabled",t.getMemberByPlayerId().scoresLine.length>=3),e.xp6(4),e.Oqu(e.lcZ(12,4,"games.train.stationsShort")),e.xp6(2),e.Q6J("disabled",t.getMemberByPlayerId().scoresLine.length<=0))},directives:[r.FN,r.Nd,r.wI,r.Q$,r.YG,r.gu],pipes:[p.X$],styles:[""]}),n})();function ee(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-row",1),e.TgZ(1,"ion-col",2),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"ion-col",3),e.TgZ(5,"div",4),e.TgZ(6,"ion-button",5),e.NdJ("click",function(){const c=e.CHM(o).$implicit;return e.oxw().removeFromScoresLine(c.value)}),e._UZ(7,"ion-icon",6),e.qZA(),e.TgZ(8,"span",7),e._UZ(9,"ion-icon",8),e._uU(10),e.qZA(),e.TgZ(11,"ion-button",9),e.NdJ("click",function(){const c=e.CHM(o).$implicit;return e.oxw().addToScoresLine(c.value)}),e._UZ(12,"ion-icon",10),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&n){const o=s.$implicit,t=e.oxw();e.xp6(3),e.Oqu(t.calcQtyOfArrItems(o.value)),e.xp6(7),e.hij(" ",o.name," ")}}let oe=(()=>{class n extends A{constructor(o){super(o),this.carsScoresEnv=u.N.games.train.carsScores}ngOnInit(){}calcQtyOfArrItems(o){return this.sharedService.calcQtyOfArrItems(o,this.playerId,this.roundId)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(e.zs3))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-round-cars"]],features:[e._Bn([{provide:_,useExisting:n}]),e.qOj],decls:2,vars:1,consts:[["class","round round_tools",4,"ngFor","ngForOf"],[1,"round","round_tools"],[1,"round_tools__score"],[1,"round_tools__btn"],[1,"incDecBtn"],["shape","round","color","danger","fill","outline",3,"click"],["name","remove-outline"],[1,"incDecBtn__caption"],["name","train-outline"],["shape","round","color","success","fill","outline",3,"click"],["name","add-outline"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-card-content"),e.YNc(1,ee,13,2,"ion-row",0),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngForOf",t.carsScoresEnv))},directives:[r.FN,d.sg,r.Nd,r.wI,r.Q$,r.YG,r.gu],styles:[""]}),n})();function ne(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-col",4),e.TgZ(1,"img",5),e.NdJ("click",function(){const c=e.CHM(o).$implicit;return e.oxw().addToNamedScoresLine(c)}),e.qZA(),e.qZA()}if(2&n){const o=s.$implicit;e.xp6(1),e.Q6J("src",o.picture,e.LSH)("alt",o.name)}}function te(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-col",6),e.TgZ(1,"img",7),e.NdJ("click",function(){const c=e.CHM(o).$implicit;return e.oxw().removeFromNamedScoresLine(c)}),e.qZA(),e.qZA()}if(2&n){const o=s.$implicit;e.xp6(1),e.Q6J("src",o.picture,e.LSH)("alt",o.name)}}let re=(()=>{class n extends A{constructor(o){super(o),this.namedScoresEnv=u.N.games.uno.namedScores,this.namedScoreLine=[]}ngOnInit(){}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(e.zs3))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-round-uno"]],features:[e._Bn([{provide:_,useExisting:n}]),e.qOj],decls:5,vars:2,consts:[[1,"round","round_tools"],["size","2.4",4,"ngFor","ngForOf"],[1,"round","round_result"],["size","1",4,"ngFor","ngForOf"],["size","2.4"],[1,"uno-round-img",3,"src","alt","click"],["size","1"],[3,"src","alt","click"]],template:function(o,t){if(1&o&&(e.TgZ(0,"ion-card-content"),e.TgZ(1,"ion-row",0),e.YNc(2,ne,2,2,"ion-col",1),e.qZA(),e.TgZ(3,"ion-row",2),e.YNc(4,te,2,2,"ion-col",3),e.qZA(),e.qZA()),2&o){let i;e.xp6(2),e.Q6J("ngForOf",t.namedScoresEnv),e.xp6(2),e.Q6J("ngForOf",null==(i=t.getMemberByPlayerId())?null:i.namedScoresLine)}},directives:[r.FN,r.Nd,d.sg,r.wI],styles:[""]}),n})();function ie(n,s){1&n&&e._UZ(0,"app-choose-players")}function se(n,s){if(1&n&&(e._UZ(0,"app-round-routes",6),e.ALo(1,"async"),e.ALo(2,"async")),2&n){const o=e.oxw(3);e.Q6J("roundId",e.lcZ(1,2,o.activeRoundId$))("playerId",e.lcZ(2,4,o.activePlayerId$))}}function ce(n,s){if(1&n&&(e._UZ(0,"app-round-length",6),e.ALo(1,"async"),e.ALo(2,"async")),2&n){const o=e.oxw(3);e.Q6J("roundId",e.lcZ(1,2,o.activeRoundId$))("playerId",e.lcZ(2,4,o.activePlayerId$))}}function le(n,s){if(1&n&&(e._UZ(0,"app-round-stations",6),e.ALo(1,"async"),e.ALo(2,"async")),2&n){const o=e.oxw(3);e.Q6J("roundId",e.lcZ(1,2,o.activeRoundId$))("playerId",e.lcZ(2,4,o.activePlayerId$))}}function ae(n,s){if(1&n&&(e._UZ(0,"app-round-cars",6),e.ALo(1,"async"),e.ALo(2,"async")),2&n){const o=e.oxw(3);e.Q6J("roundId",e.lcZ(1,2,o.activeRoundId$))("playerId",e.lcZ(2,4,o.activePlayerId$))}}function de(n,s){if(1&n&&(e.TgZ(0,"app-round-wrapper",4),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,se,3,6,"app-round-routes",5),e.YNc(5,ce,3,6,"app-round-length",5),e.YNc(6,le,3,6,"app-round-stations",5),e.YNc(7,ae,3,6,"app-round-cars",5),e.qZA()),2&n){const o=e.oxw(2);e.Q6J("ngSwitch",e.lcZ(1,7,o.activeRoundId$))("roundId",e.lcZ(2,9,o.activeRoundId$))("playerId",e.lcZ(3,11,o.activePlayerId$)),e.xp6(4),e.Q6J("ngSwitchCase","routes"),e.xp6(1),e.Q6J("ngSwitchCase","length"),e.xp6(1),e.Q6J("ngSwitchCase","stations"),e.xp6(1),e.Q6J("ngSwitchCase","cars")}}function ue(n,s){if(1&n&&(e.TgZ(0,"app-round-wrapper",6),e.ALo(1,"async"),e.ALo(2,"async"),e._UZ(3,"app-round-uno",6),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()),2&n){const o=e.oxw(2);e.Q6J("roundId",e.lcZ(1,4,o.activeRoundId$))("playerId",e.lcZ(2,6,o.activePlayerId$)),e.xp6(3),e.Q6J("roundId",e.lcZ(4,8,o.activeRoundId$))("playerId",e.lcZ(5,10,o.activePlayerId$))}}function pe(n,s){if(1&n&&(e.YNc(0,de,8,13,"app-round-wrapper",2),e.ALo(1,"async"),e.YNc(2,ue,6,12,"app-round-wrapper",3),e.ALo(3,"async")),2&n){const o=e.oxw();e.Q6J("ngIf","train"===e.lcZ(1,2,o.gameType$)),e.xp6(2),e.Q6J("ngIf","uno"===e.lcZ(3,4,o.gameType$))}}let me=(()=>{class n{constructor(o){this.store=o}ngOnInit(){this.rounds$=this.store.select(b.PK)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(f.yh))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-round"]],inputs:{activeRoundId$:"activeRoundId$",activePlayerId$:"activePlayerId$",gameType$:"gameType$"},decls:5,vars:6,consts:[[4,"ngIf","ngIfElse"],["restRounds",""],[3,"ngSwitch","roundId","playerId",4,"ngIf"],[3,"roundId","playerId",4,"ngIf"],[3,"ngSwitch","roundId","playerId"],[3,"roundId","playerId",4,"ngSwitchCase"],[3,"roundId","playerId"]],template:function(o,t){if(1&o&&(e.YNc(0,ie,1,0,"app-choose-players",0),e.ALo(1,"async"),e.ALo(2,"async"),e.YNc(3,pe,4,6,"ng-template",null,1,e.W1O)),2&o){const i=e.MAs(4);e.Q6J("ngIf","start"===e.lcZ(1,2,t.activeRoundId$)&&0===e.lcZ(2,4,t.rounds$).length)("ngIfElse",i)}},directives:[d.O5,j,E,d.RF,d.n9,W,K,V,oe,re],pipes:[d.Ov],styles:[""]}),n})();function _e(n,s){if(1&n&&(e.TgZ(0,"ion-segment-button",9),e.ALo(1,"async"),e.ALo(2,"async"),e._UZ(3,"ion-icon",10),e.qZA()),2&n){const o=s.$implicit,t=e.oxw(2);e.Q6J("value",o._id)("disabled","start"===o._id&&e.lcZ(1,3,t.rounds$).length||"start"!==o._id&&0===e.lcZ(2,5,t.rounds$).length),e.xp6(3),e.Q6J("name",o.icon)}}function ge(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-segment",7),e.NdJ("ionChange",function(i){return e.CHM(o),e.oxw().onMenuClickHandler(i)}),e.ALo(1,"async"),e.YNc(2,_e,4,7,"ion-segment-button",8),e.qZA()}if(2&n){const o=e.oxw();e.Q6J("value",e.lcZ(1,2,o.activeRoundId$)),e.xp6(2),e.Q6J("ngForOf",o.roundsCfg)}}const he=function(n){return{"active-player":n}},Ze=function(n){return{"border-left":n,"padding-left":"10px"}},ye=function(n){return{"border-right":n,"padding-right":"10px"}};function fe(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-item",16),e.NdJ("click",function(){const c=e.CHM(o).$implicit;return e.oxw(2).selectPlayer(c._id)}),e.ALo(1,"async"),e.TgZ(2,"ion-label",17),e._uU(3),e.qZA(),e.TgZ(4,"div",18),e._uU(5),e.qZA(),e.qZA()}if(2&n){const o=s.$implicit,t=e.oxw(2);e.Q6J("ngClass",e.VKq(7,he,o._id===e.lcZ(1,5,t.activePlayerId$))),e.xp6(2),e.Q6J("ngStyle",e.VKq(9,Ze,"6px solid "+o.color)),e.xp6(1),e.hij(" ",o.name," "),e.xp6(1),e.Q6J("ngStyle",e.VKq(11,ye,"6px solid "+o.color)),e.xp6(1),e.hij(" ",t.getPlayerTotalScores(o._id)," ")}}function ve(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-button",19),e.NdJ("click",function(){return e.CHM(o),e.oxw(2).openNextRound()}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"elements.button.nextRound")," "))}function Ce(n,s){if(1&n){const o=e.EpF();e.TgZ(0,"ion-card"),e.TgZ(1,"ion-card-header"),e.TgZ(2,"ion-card-title",11),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"ion-card-content"),e.TgZ(5,"ion-list"),e.YNc(6,fe,6,13,"ion-item",12),e.qZA(),e.TgZ(7,"ion-row",13),e.TgZ(8,"ion-button",14),e.NdJ("click",function(){return e.CHM(o),e.oxw().onFinishGameHandler()}),e.ALo(9,"async"),e.ALo(10,"async"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"ion-button",14),e.NdJ("click",function(){return e.CHM(o),e.oxw().onCancelGameHandler()}),e.ALo(14,"async"),e.ALo(15,"async"),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.YNc(18,ve,3,3,"ion-button",15),e.qZA(),e.qZA(),e.qZA()}if(2&n){const o=e.oxw();e.xp6(3),e.Oqu(null==o.environment.games[o.gameType]?null:o.environment.games[o.gameType].name),e.xp6(3),e.Q6J("ngForOf",o.playersWithTotal),e.xp6(2),e.Q6J("disabled",0===e.lcZ(9,7,o.rounds$).length||e.lcZ(10,9,o.loading$)),e.xp6(3),e.hij(" ",e.lcZ(12,11,"elements.button.finishGame")," "),e.xp6(2),e.Q6J("disabled",0===e.lcZ(14,13,o.rounds$).length||e.lcZ(15,15,o.loading$)),e.xp6(3),e.hij(" ",e.lcZ(17,17,"elements.button.cancelGame")," "),e.xp6(2),e.Q6J("ngIf","uno"===o.gameType)}}function Te(n,s){if(1&n&&(e.TgZ(0,"ion-col",4),e._UZ(1,"app-round",20),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("activeRoundId$",o.activeRoundId$)("activePlayerId$",o.activePlayerId$)("gameType$",o.gameType$)}}const xe=[{path:"",component:(()=>{class n{constructor(o,t,i,c){this.store=o,this.sharedService=t,this.route=i,this.gameService=c,this.environment=u.N,this.showToolbarMenu=!1,this.activeRoundId$=new q.t(1),this.activePlayerId$=new q.t(1)}ngOnInit(){this.loading$=this.store.select(h.NH),this.gameType$=this.store.select(h.Wn),this.rounds$=this.store.select(b.PK),(0,w.aj)([this.gameType$,this.rounds$]).subscribe(([o,t])=>{!o||(this.gameType=o,this.showToolbarMenu=u.N.games[o].showToolbarMenu,this.roundsCfg=u.N.games[o].rounds,"uno"===o&&(this.unoRound=this.roundsCfg[1]),this.rounds=t,this.roundsCfg&&this.activeRoundId$.next(t.length?"uno"===this.gameType?this.roundsCfg[1]._id+(1===t.length?this.roundsCfg[1].namePostfix:t.length):this.roundsCfg[1]._id:this.roundsCfg[0]._id))}),this.roundMembers$=this.store.select(J.uW),this.players$=this.store.select(P.y1),this.players$.subscribe(o=>{this.activePlayerId$.next(o[0]._id)}),this.players$.pipe((0,L.w)(o=>(this.players=o,this.roundMembers$))).subscribe(o=>{this.roundMembers=o,this.playersWithTotal=this.players.map(t=>Object.assign(Object.assign({},t),{totalScore:this.getPlayerTotalScores(t._id)})).sort((t,i)=>i.totalScore-t.totalScore)}),this.activePlayerId$.subscribe(o=>this.activePlayerId=o),this.route.params.subscribe(o=>{})}getPlayerTotalScores(o){return this.sharedService.getPlayerTotalScores(o)}onMenuClickHandler(o){this.activeRoundId$.next(o.target.value)}onFinishGameHandler(){this.store.dispatch(T.V_({loading:!0}));const o=this.rounds.map(c=>{const l=c.roundMembers.map(m=>{const N=this.roundMembers.find(I=>I._id===m);return{_id:N.player,score:N.scoresLine.reduce((I,qe)=>I+qe,0)}});return{_id:c._id,players:l}}),t={_id:"result",players:this.players.map(c=>({_id:c._id,score:this.getPlayerTotalScores(c._id)}))},i={type:this.rounds[0].clientGame.type,rounds:[...o,t]};this.gameService.add(i).subscribe(c=>{this.onCancelGameHandler()},c=>this.store.dispatch(T.V_({loading:!1})))}onCancelGameHandler(){this.store.dispatch(T.GJ())}openNextRound(){this.sharedService.addRounds(this.unoRound)}selectPlayer(o){this.activePlayerId$.next(o)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(f.yh),e.Y36(v.F),e.Y36(C.gz),e.Y36(F.h))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-game"]],decls:15,vars:9,consts:[["slot","end"],["menu","games-menu"],["scrollable","",3,"value","ionChange",4,"ngIf"],[1,"ion-no-margin","ion-no-padding"],["size-lg","6","size-md","8","size-sm","10","offset-lg","3","offset-md","2","offset-sm","1"],[4,"ngIf"],["size-lg","6","size-md","8","size-sm","10","offset-lg","3","offset-md","2","offset-sm","1",4,"ngIf"],["scrollable","",3,"value","ionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],[3,"name"],[1,"ion-text-center"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"ion-justify-content-around"],["fill","outline","size","small",3,"disabled","click"],["fill","outline","size","small",3,"click",4,"ngIf"],[3,"ngClass","click"],[3,"ngStyle"],["slot","end",3,"ngStyle"],["fill","outline","size","small",3,"click"],[3,"activeRoundId$","activePlayerId$","gameType$"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-buttons",0),e._UZ(3,"ion-menu-button",1),e.qZA(),e.YNc(4,ge,3,4,"ion-segment",2),e.qZA(),e.qZA(),e.TgZ(5,"ion-content"),e.TgZ(6,"ion-grid",3),e.TgZ(7,"ion-row"),e.TgZ(8,"ion-col",4),e.YNc(9,Ce,19,19,"ion-card",5),e.ALo(10,"async"),e.qZA(),e.qZA(),e.TgZ(11,"ion-row"),e.YNc(12,Te,2,3,"ion-col",6),e.ALo(13,"async"),e.ALo(14,"async"),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(4),e.Q6J("ngIf",t.showToolbarMenu),e.xp6(5),e.Q6J("ngIf",0!==e.lcZ(10,3,t.rounds$).length),e.xp6(3),e.Q6J("ngIf",e.lcZ(13,5,t.activeRoundId$)&&e.lcZ(14,7,t.activePlayerId$)))},directives:[r.Gu,r.sr,r.Sm,r.fG,d.O5,r.W2,r.jY,r.Nd,r.wI,r.cJ,r.QI,d.sg,r.GO,r.gu,r.PM,r.Zi,r.Dq,r.FN,r.q_,r.YG,r.Ie,d.mk,r.Q$,d.PC,me],pipes:[d.Ov,p.X$],styles:[""]}),n})()}];let Ae=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[C.Bz.forChild(xe)],C.Bz]}),n})(),$=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.u5,d.ez,r.Pc,p.aw.forChild({extend:!0})]]}),n})(),Ie=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[d.ez,g.u5,r.Pc,p.aw.forChild({extend:!0}),$]]}),n})(),Se=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[d.ez,g.u5,r.Pc,Ae,p.aw.forChild({extend:!0}),Ie,$]]}),n})()}}]);