"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4335],{4335:(se,x,a)=>{a.r(x),a.d(x,{TrainPageModule:()=>ie});var _=a(6019),p=a(9133),i=a(4662),g=a(1880),q=a(4099),m=a(3783),u=a(8260),T=a(8761),C=a(3051),e=a(3668),y=a(607),v=a(6382),b=a(3093),J=a(5722),P=a(9204),h=a(4762);const S=function(t){return{"background-color":t}};function w(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-col",2),e.NdJ("click",function(){const s=e.CHM(o).$implicit;return e.oxw().onSelect(s)}),e._UZ(1,"div",3),e.qZA()}if(2&t){const o=c.$implicit;e.xp6(1),e.Q6J("ngStyle",e.VKq(1,S,o))}}let A=(()=>{class t{constructor(o){this.popoverController=o}ngOnInit(){}dismiss(o){this.popoverController.dismiss(o)}onSelect(o){this.dismiss({color:o})}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(i.Dh))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-select-color"]],inputs:{colors:"colors"},decls:5,vars:1,consts:[[1,"select-color"],["class","select-color__container",3,"click",4,"ngFor","ngForOf"],[1,"select-color__container",3,"click"],[1,"select-color__item",3,"ngStyle"]],template:function(o,n){1&o&&(e.TgZ(0,"ion-card"),e.TgZ(1,"ion-card-content"),e.TgZ(2,"ion-grid"),e.TgZ(3,"ion-row",0),e.YNc(4,w,2,3,"ion-col",1),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(4),e.Q6J("ngForOf",n.colors))},directives:[i.PM,i.FN,i.jY,i.Nd,_.sg,i.wI,_.PC],styles:[""]}),t})();var Z=a(3085);const $=function(t){return{"background-color":t}};let k=(()=>{class t{constructor(o){this.popoverController=o,this.playersColors=u.N.games.train.playersColors,this.color=this.playersColors[0]}ngOnInit(){}presentPopover(o,n,r){return(0,h.mG)(this,void 0,void 0,function*(){const s=yield this.popoverController.create({component:n,cssClass:"select-color-popover",componentProps:r,translucent:!0});return yield s.present(),yield s.onDidDismiss()})}showSelectColorPopup(o){return(0,h.mG)(this,void 0,void 0,function*(){const{data:n}=yield this.presentPopover(o,A,{colors:this.playersColors});if(n){const{color:r}=n;this.color=r}})}dismiss(o){this.popoverController.dismiss(o)}onCreate(){this.dismiss({gamer:{color:this.color,name:this.name}})}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(i.Dh))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-create-gamer"]],decls:23,vars:8,consts:[["slot","end"],[3,"click"],["lines","none"],[1,"choose-players"],[1,"choose-players__color"],[1,"select-color",3,"ngStyle","click"],[1,"choose-players__name"],["placeholder","Enter Name","clearInput","",3,"ngModel","ngModelChange"],["expand","block",3,"disabled","click"]],template:function(o,n){1&o&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-title"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-buttons",0),e.TgZ(6,"ion-button",1),e.NdJ("click",function(){return n.dismiss()}),e._uU(7,"close"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"ion-content"),e.TgZ(9,"ion-card"),e.TgZ(10,"ion-card-content"),e.TgZ(11,"ion-list"),e.TgZ(12,"ion-item",2),e.TgZ(13,"div",3),e.TgZ(14,"div",4),e.TgZ(15,"div",5),e.NdJ("click",function(s){return n.showSelectColorPopup(s)}),e.qZA(),e.qZA(),e.TgZ(16,"div",6),e.TgZ(17,"ion-item"),e.TgZ(18,"ion-input",7),e.NdJ("ngModelChange",function(s){return n.name=s}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"ion-row"),e.TgZ(20,"ion-col"),e.TgZ(21,"ion-button",8),e.NdJ("click",function(){return n.onCreate()}),e._uU(22,"create "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Oqu(e.lcZ(4,4,"modules.games.createGamer")),e.xp6(12),e.Q6J("ngStyle",e.VKq(6,$,n.color)),e.xp6(3),e.Q6J("ngModel",n.name),e.xp6(3),e.Q6J("disabled",!n.name))},directives:[i.Gu,i.sr,i.wd,i.Sm,i.YG,i.W2,i.PM,i.FN,i.q_,i.Ie,_.PC,i.pK,i.j9,p.JJ,p.On,i.Nd,i.wI],pipes:[Z.X$],styles:[""]}),t})();var f=a(5803),O=a(9973);function N(t,c){if(1&t&&(e.TgZ(0,"ion-select-option",15),e._uU(1),e.qZA()),2&t){const o=c.$implicit;e.Q6J("value",o),e.xp6(1),e.hij(" ",o.name," ")}}const F=function(t){return{"background-color":t}};function R(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-item-sliding",9),e.TgZ(1,"ion-item",9),e.TgZ(2,"div",10),e.TgZ(3,"div",11),e.TgZ(4,"div",12),e.NdJ("click",function(r){const l=e.CHM(o).index,d=e.oxw();return d.filtredColors.length?d.showSelectColorPopup(r,l):null}),e.qZA(),e.qZA(),e.TgZ(5,"div",13),e.TgZ(6,"ion-item"),e.TgZ(7,"ion-select",14),e.NdJ("ionChange",function(r){const l=e.CHM(o).index;return e.oxw().choosePlayerHandler(r,l)}),e.TgZ(8,"ion-select-option",15),e._uU(9),e.qZA(),e.YNc(10,N,2,2,"ion-select-option",16),e.qZA(),e.TgZ(11,"ion-note",17),e._UZ(12,"ion-icon",18),e._UZ(13,"ion-icon",19),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"ion-item-options",20),e.TgZ(15,"ion-item-option",21),e.NdJ("click",function(){const s=e.CHM(o).$implicit;return e.oxw().removePlayerHandler(s._id)}),e._uU(16,"Remove"),e.qZA(),e.qZA(),e.qZA()}if(2&t){const o=c.$implicit,n=e.oxw();e.xp6(4),e.Q6J("ngStyle",e.VKq(5,F,null==o?null:o.color)),e.xp6(3),e.Q6J("value",o),e.xp6(1),e.Q6J("value",o),e.xp6(1),e.hij(" ",o.name," "),e.xp6(1),e.Q6J("ngForOf",n.filtredGamers)}}let Q=(()=>{class t{constructor(o,n,r,s,l,d){this.store=o,this.translate=n,this.gamerService=r,this.popoverController=s,this.alertController=l,this.sharedService=d,this.gamers=[],this.filtredGamers=[],this.players=[],this.playersColors=u.N.games.train.playersColors,this.filtredColors=u.N.games.train.playersColors}ngOnInit(){this.players$=this.store.select(C.y1),this.players$.subscribe(o=>{this.players=o,this.filter()}),this.gamers$=this.gamerService.entities$,this.gamers$.subscribe(o=>{this.gamers=o,this.filter()})}startGameHandler(){this.sharedService.createRounds("train")}presentPopover(o,n,r){return(0,h.mG)(this,void 0,void 0,function*(){const s=yield this.popoverController.create({component:n,cssClass:"select-color-popover",componentProps:r,translucent:!0});return yield s.present(),yield s.onDidDismiss()})}showSelectColorPopup(o,n){return(0,h.mG)(this,void 0,void 0,function*(){const{data:r}=yield this.presentPopover(o,A,{colors:this.filtredColors});if(r){const{color:s}=r;this.chooseColorHandler(s,n)}})}showCreateGamerPopup(o){return(0,h.mG)(this,void 0,void 0,function*(){const{data:n}=yield this.presentPopover(o,k,null);if(n){const{gamer:r}=n;console.log("gamer",n),this.createGamerHandler(r)}})}filter(){this.filtredGamers=this.gamers.filter(o=>{for(const n of this.players)if(n._id===o._id)return!1;return!0}),this.filtredColors=this.playersColors.filter(o=>{for(const n of this.players)if(n.color===o)return!1;return!0})}choosePlayerHandler(o,n){const r=this.players.map((s,l)=>l===n?this.filtredColors.includes(this.filtredGamers[0].color)?o.target.value:Object.assign(Object.assign({},o.target.value),{color:this.filtredColors[0]}):s);console.log("players",r),this.store.dispatch(f.K9({players:r}))}chooseColorHandler(o,n){this.players=this.players.map((r,s)=>s===n?Object.assign(Object.assign({},r),{color:o}):r),this.filter()}removePlayerHandler(o){this.store.dispatch(f.WQ({id:o}))}removeAllPlayersHandler(){this.store.dispatch(f.dO())}addPlayerHandler(o=!0){if(!this.filtredGamers.length)return;let n=this.filtredGamers[0];o||(n=this.filtredGamers[this.filtredGamers.length-1]),this.filtredColors.includes(n.color)?this.store.dispatch(f.KM({player:Object.assign({},n)})):this.store.dispatch(f.KM({player:Object.assign(Object.assign({},n),{color:this.filtredColors[0]})}))}createGamerHandler(o){this.gamerService.add(o).subscribe(n=>{console.log(n)})}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(y.yh),e.Y36(Z.sK),e.Y36(O.E),e.Y36(i.Dh),e.Y36(i.Br),e.Y36(v.F))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-choose-players"]],decls:25,vars:9,consts:[[1,"ion-text-center"],[1,"choose-players"],[1,"choose-players__list"],["lines","none",4,"ngFor","ngForOf"],[1,"choose-players__btn-block"],["expand","block","fill","outline","size","small","color","secondary",3,"disabled","click"],["expand","block","fill","outline","size","small","color","success",3,"disabled","click"],["expand","block","fill","outline","size","small","color","danger",3,"click"],["expand","block",3,"disabled","click"],["lines","none"],[1,"players-list"],[1,"players-list__color"],[1,"select-color",3,"ngStyle","click"],[1,"players-list__name"],["placeholder","Select One","interface","popover","slot","end",3,"value","ionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["slot","end","color","danger"],["name","trash-outline"],["name","caret-back-outline"],["side","end"],["color","danger",3,"click"]],template:function(o,n){1&o&&(e.TgZ(0,"ion-card"),e.TgZ(1,"ion-card-header"),e.TgZ(2,"ion-card-title",0),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-card-subtitle",0),e._uU(6,"Ticket to the ride"),e.qZA(),e.qZA(),e.TgZ(7,"ion-card-content",1),e.TgZ(8,"ion-list",2),e.YNc(9,R,17,7,"ion-item-sliding",3),e.ALo(10,"async"),e.qZA(),e.TgZ(11,"ion-row",4),e.TgZ(12,"ion-col"),e.TgZ(13,"ion-button",5),e.NdJ("click",function(){return n.addPlayerHandler()}),e._uU(14," add "),e.qZA(),e.qZA(),e.TgZ(15,"ion-col"),e.TgZ(16,"ion-button",6),e.NdJ("click",function(s){return n.showCreateGamerPopup(s)}),e._uU(17," create "),e.qZA(),e.qZA(),e.TgZ(18,"ion-col"),e.TgZ(19,"ion-button",7),e.NdJ("click",function(){return n.removeAllPlayersHandler()}),e._uU(20,"remove all "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(21,"ion-row",4),e.TgZ(22,"ion-col"),e.TgZ(23,"ion-button",8),e.NdJ("click",function(){return n.startGameHandler()}),e._uU(24,"start game "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Oqu(e.lcZ(4,5,"modules.games.addPlayers")),e.xp6(6),e.Q6J("ngForOf",e.lcZ(10,7,n.players$)),e.xp6(4),e.Q6J("disabled",n.players.length>=5),e.xp6(3),e.Q6J("disabled",n.players.length>=5),e.xp6(7),e.Q6J("disabled",n.players.length<2))},directives:[i.PM,i.Zi,i.Dq,i.tO,i.FN,i.q_,_.sg,i.Nd,i.wI,i.YG,i.td,i.Ie,_.PC,i.t9,i.QI,i.n0,i.uN,i.gu,i.IK,i.u8],pipes:[Z.X$,_.Ov],styles:[""]}),t})();function G(t,c){1&t&&e._UZ(0,"app-choose-players")}function M(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-col",12),e.TgZ(1,"ion-chip",13),e.NdJ("click",function(){const s=e.CHM(o).$implicit,l=e.oxw(2).$implicit,d=e.oxw(2);return d.addToScoresLine(l._id,s*d.inverse[l._id])}),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e.qZA(),e.qZA()}if(2&t){const o=c.$implicit,n=e.oxw(2).$implicit,r=e.oxw(2);e.xp6(1),e.Q6J("color",o>19?"secondary":"warning"),e.xp6(2),e.Oqu(o*r.inverse[n._id])}}function U(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-col",12),e.TgZ(1,"ion-chip",17),e.NdJ("click",function(){const s=e.CHM(o).$implicit,l=e.oxw(2).$implicit;return e.oxw(2).removeFromScoresLine(l._id,s)}),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e._UZ(4,"ion-icon",18),e.qZA(),e.qZA()}if(2&t){const o=c.$implicit;e.xp6(1),e.Q6J("color",o>19?"secondary":"warning"),e.xp6(2),e.Oqu(o)}}function H(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-card-content"),e.TgZ(1,"ion-row",10),e.YNc(2,M,4,2,"ion-col",11),e.TgZ(3,"ion-col",12),e.TgZ(4,"ion-chip",13),e.NdJ("click",function(){e.CHM(o);const r=e.oxw().$implicit;return e.oxw(2).inverseScore(r._id)}),e._UZ(5,"ion-icon",14),e._UZ(6,"ion-icon",15),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"ion-row",16),e.YNc(8,U,5,2,"ion-col",11),e.qZA(),e.qZA()}if(2&t){const o=e.oxw().$implicit,n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.routeScoresEnv),e.xp6(2),e.Q6J("color","danger"),e.xp6(4),e.Q6J("ngForOf",null==o?null:o.scoresLine)}}function Y(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-card-content"),e.TgZ(1,"ion-row"),e.TgZ(2,"ion-col",10),e.TgZ(3,"div"),e._uU(4,"Mark as longest"),e.qZA(),e.TgZ(5,"ion-toggle",19),e.NdJ("ionChange",function(r){e.CHM(o);const s=e.oxw().$implicit;return e.oxw(2).onMarkLongestHandler(r,s._id)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&t){const o=e.oxw().$implicit;e.xp6(5),e.Q6J("checked",o.scoresLine.length)}}function L(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-card-content"),e.TgZ(1,"ion-row",10),e.TgZ(2,"ion-col",20),e.TgZ(3,"ion-label"),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"ion-col",21),e.TgZ(6,"div",22),e.TgZ(7,"ion-button",23),e.NdJ("click",function(){e.CHM(o);const r=e.oxw().$implicit;return e.oxw(2).addToScoresLine(r._id,4)}),e._UZ(8,"ion-icon",15),e.qZA(),e.TgZ(9,"span",24),e._uU(10,"Stations"),e.qZA(),e.TgZ(11,"ion-button",25),e.NdJ("click",function(){e.CHM(o);const r=e.oxw().$implicit;return e.oxw(2).removeFromScoresLine(r._id,4)}),e._UZ(12,"ion-icon",14),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&t){const o=e.oxw().$implicit,n=e.oxw(2);e.xp6(4),e.Oqu(3-n.calcScores(o.scoresLine)/4),e.xp6(3),e.Q6J("disabled",o.scoresLine.length>=3),e.xp6(4),e.Q6J("disabled",o.scoresLine.length<=0)}}function I(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-row",10),e.TgZ(1,"ion-col",20),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"ion-col",21),e.TgZ(5,"div",22),e.TgZ(6,"ion-button",27),e.NdJ("click",function(){const s=e.CHM(o).$implicit,l=e.oxw(2).$implicit;return e.oxw(2).removeFromScoresLine(l._id,s.score)}),e._UZ(7,"ion-icon",15),e.qZA(),e.TgZ(8,"span",24),e._UZ(9,"ion-icon",28),e._uU(10),e.qZA(),e.TgZ(11,"ion-button",29),e.NdJ("click",function(){const s=e.CHM(o).$implicit,l=e.oxw(2).$implicit;return e.oxw(2).addToScoresLine(l._id,s.score)}),e._UZ(12,"ion-icon",14),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&t){const o=c.$implicit,n=e.oxw(2).$implicit,r=e.oxw(2);e.xp6(3),e.Oqu(r.calcQtyOfArrItems(n._id,o.score)),e.xp6(7),e.hij(" ",o.qty," ")}}function j(t,c){if(1&t&&(e.TgZ(0,"ion-card-content"),e.YNc(1,I,13,2,"ion-row",26),e.qZA()),2&t){const o=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",o.carsCfg)}}const E=function(t){return{"border-bottom":t}};function z(t,c){if(1&t&&(e.TgZ(0,"ion-card"),e.TgZ(1,"ion-card-header",3),e.TgZ(2,"ion-card-subtitle"),e.TgZ(3,"span",4),e._UZ(4,"ion-icon",5),e.TgZ(5,"span",6),e._uU(6),e.qZA(),e._UZ(7,"span",7),e.TgZ(8,"span"),e._uU(9),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"ion-card-title",8),e._uU(11),e.qZA(),e.qZA(),e.YNc(12,H,9,3,"ion-card-content",9),e.YNc(13,Y,6,1,"ion-card-content",9),e.YNc(14,L,13,3,"ion-card-content",9),e.YNc(15,j,2,1,"ion-card-content",9),e.qZA()),2&t){const o=c.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngStyle",e.VKq(9,E,"2px solid "+n.getPlayerColor(o._id))),e.xp6(3),e.Q6J("name",null==n.activeRound?null:n.activeRound.icon),e.xp6(2),e.Oqu(null==n.activeRound?null:n.activeRound._id),e.xp6(3),e.Oqu(n.calcScores(o.scoresLine)),e.xp6(2),e.Oqu(n.getPlayerName(o._id)),e.xp6(1),e.Q6J("ngIf","routes"===n.round._id),e.xp6(1),e.Q6J("ngIf","length"===n.round._id),e.xp6(1),e.Q6J("ngIf","stations"===n.round._id),e.xp6(1),e.Q6J("ngIf","cars"===n.round._id)}}function K(t,c){if(1&t&&e.YNc(0,z,16,11,"ion-card",2),2&t){const o=e.oxw();e.Q6J("ngForOf",o.round.players)}}let D=(()=>{class t{constructor(o,n){this.route=o,this.store=n,this.roundsCfg=u.N.games.train.rounds,this.carsCfg=u.N.games.train.cars,this.routeScoresEnv=u.N.games.train.routeScores,this.inverse={}}ngOnInit(){this.activeRound$.pipe((0,J.b)(o=>this.activeRound=o),(0,P.w)(o=>this.store.select(T.G5(o._id)))).subscribe(o=>{console.log("round",o),o&&(this.round=o,this.round.players.forEach(n=>this.inverse[n._id]=1))}),this.rounds$=this.store.select(T.yh),this.rounds$.subscribe(o=>{this.rounds=o,console.log("rounds",o)}),this.players$=this.store.select(C.y1),this.players$.subscribe(o=>{this.players=o})}calcScores(o){return o.reduce((n,r)=>n+r,0)}getPlayerColor(o){return this.players.find(n=>n._id===o).color}getPlayerName(o){return this.players.find(n=>n._id===o).name}calcQtyOfArrItems(o,n){let r=0;return this.round.players.forEach(s=>{s._id===o&&s.scoresLine.forEach(l=>{l===n&&r++})}),r}inverseScore(o){this.inverse[o]=-1*this.inverse[o]}addToScoresLine(o,n){console.log("upd",n);const r=this.round.players.map(s=>s._id===o?Object.assign(Object.assign({},s),{scoresLine:[...s.scoresLine,n]}):s);this.store.dispatch(m.TK({round:{id:this.round._id,changes:{players:r}}}))}removeFromScoresLine(o,n){const r=this.round.players.map(s=>{if(s._id===o){const l=[...s.scoresLine],d=l.indexOf(n);if(l.splice(d,1),-1!==d)return Object.assign(Object.assign({},s),{scoresLine:l})}return s});this.store.dispatch(m.TK({round:{id:this.round._id,changes:{players:r}}}))}setScoresLine(o,n){const r=this.round.players.map(s=>s._id===o?Object.assign(Object.assign({},s),{scoresLine:n}):s);this.store.dispatch(m.TK({round:{id:this.round._id,changes:{players:r}}}))}onMarkLongestHandler(o,n){this.setScoresLine(n,o.target.checked?[10]:[])}onChangeStationsHandler(o){console.log("e-value",o.target.value)}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(g.gz),e.Y36(y.yh))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-train-rounds"]],inputs:{activeRound$:"activeRound$"},decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["restRounds",""],[4,"ngFor","ngForOf"],[3,"ngStyle"],[1,"round-subtitle"],["color","primary",1,"round-subtitle__icon",3,"name"],[1,"ion-text-capitalize"],[1,"round-subtitle__blank"],[1,"ion-text-center"],[4,"ngIf"],[1,"round","round_tools"],["size","3",4,"ngFor","ngForOf"],["size","3"],[3,"color","click"],["name","add-outline"],["name","remove-outline"],[1,"round","round_result"],["outline","",3,"color","click"],["name","close-circle"],[3,"checked","ionChange"],[1,"round_tools__score"],[1,"round_tools__btn"],[1,"incDecBtn"],["shape","round","color","danger","fill","outline",3,"disabled","click"],[1,"incDecBtn__caption"],["shape","round","color","success","fill","outline",3,"disabled","click"],["class","round round_tools",4,"ngFor","ngForOf"],["shape","round","color","danger","fill","outline",3,"click"],["name","train-outline"],["shape","round","color","success","fill","outline",3,"click"]],template:function(o,n){if(1&o&&(e.YNc(0,G,1,0,"app-choose-players",0),e.ALo(1,"async"),e.YNc(2,K,1,1,"ng-template",null,1,e.W1O)),2&o){const r=e.MAs(3);e.Q6J("ngIf","start"===(null==n.activeRound?null:n.activeRound._id)&&0===e.lcZ(1,2,n.rounds$).length)("ngIfElse",r)}},directives:[_.O5,Q,_.sg,i.PM,i.Zi,_.PC,i.tO,i.gu,i.Dq,i.FN,i.Nd,i.wI,i.hM,i.Q$,i.ho,i.w,i.YG],pipes:[_.Ov],styles:[""]}),t})();function B(t,c){if(1&t&&(e.TgZ(0,"ion-segment-button",8),e.ALo(1,"async"),e.ALo(2,"async"),e._UZ(3,"ion-icon",9),e.qZA()),2&t){const o=c.$implicit,n=e.oxw();e.Q6J("value",o)("disabled","start"===o._id&&e.lcZ(1,3,n.rounds$).length||"start"!==o._id&&0===e.lcZ(2,5,n.rounds$).length),e.xp6(3),e.Q6J("name",o.icon)}}const X=function(t){return{"border-left":t,"padding-left":"10px"}},V=function(t){return{"border-right":t,"padding-right":"10px"}};function W(t,c){if(1&t&&(e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label",14),e._uU(2),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.qZA(),e.qZA()),2&t){const o=c.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngStyle",e.VKq(4,X,"6px solid "+o.color)),e.xp6(1),e.hij(" ",o.name," "),e.xp6(1),e.Q6J("ngStyle",e.VKq(6,V,"6px solid "+o.color)),e.xp6(1),e.hij(" ",n.getPlayerTotalScores(o._id)," ")}}function ee(t,c){if(1&t){const o=e.EpF();e.TgZ(0,"ion-card"),e.TgZ(1,"ion-card-header"),e.TgZ(2,"ion-card-title",10),e._uU(3,"Ticket to the ride"),e.qZA(),e.qZA(),e.TgZ(4,"ion-card-content"),e.TgZ(5,"ion-list"),e.YNc(6,W,5,8,"ion-item",11),e.ALo(7,"async"),e.qZA(),e.TgZ(8,"ion-row",12),e.TgZ(9,"ion-button",13),e.NdJ("click",function(){return e.CHM(o),e.oxw().onFinishGameHandler()}),e.ALo(10,"async"),e._uU(11,"finish game "),e.qZA(),e.TgZ(12,"ion-button",13),e.NdJ("click",function(){return e.CHM(o),e.oxw().onCancelGameHandler()}),e.ALo(13,"async"),e._uU(14,"cancel game "),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&t){const o=e.oxw();e.xp6(6),e.Q6J("ngForOf",e.lcZ(7,3,o.players$)),e.xp6(3),e.Q6J("disabled",0===e.lcZ(10,5,o.rounds$).length),e.xp6(3),e.Q6J("disabled",0===e.lcZ(13,7,o.rounds$).length)}}const oe=[{path:"",component:(()=>{class t{constructor(o,n,r,s,l){this.route=o,this.router=n,this.store=r,this.sharedService=s,this.gameService=l,this.roundsCfg=u.N.games.train.rounds,this.activeRound$=new q.X(this.roundsCfg[0])}ngOnInit(){this.activeRound$.subscribe(o=>this.activeRound=o),this.rounds$=this.store.select(T.yh),this.rounds$.subscribe(o=>{this.rounds=o,o.length?"start"===this.activeRound._id&&this.activeRound$.next(this.roundsCfg[1]):"start"!==this.activeRound._id&&this.activeRound$.next(this.roundsCfg[0])}),this.players$=this.store.select(C.y1),this.players$.subscribe(o=>{this.players=o})}onMenuClickHandler(o){this.activeRound$.next(o.target.value)}onFinishGameHandler(){const o=this.rounds.map(r=>{const s=r.players.map(l=>({_id:l._id,score:l.scoresLine.reduce((d,re)=>d+re,0)}));return Object.assign(Object.assign({},r),{players:s})});this.gameService.add({type:this.rounds[0].clientGame.type,rounds:o}).subscribe(r=>{console.log(r),this.store.dispatch((0,m.Tz)())})}onCancelGameHandler(){this.store.dispatch((0,m.Tz)())}getPlayerTotalScores(o){let n=0;return this.rounds.forEach(r=>{r.players.forEach(s=>{s._id===o&&(n+=s.scoresLine.reduce((l,d)=>l+d,0))})}),n}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(g.gz),e.Y36(g.F0),e.Y36(y.yh),e.Y36(v.F),e.Y36(b.h))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-train"]],decls:15,vars:6,consts:[["slot","end"],["menu","games-menu"],["scrollable","",3,"value","ionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"ion-no-margin","ion-no-padding"],["size-lg","6","size-md","8","size-sm","10","offset-lg","3","offset-md","2","offset-sm","1"],[4,"ngIf"],[3,"activeRound$"],[3,"value","disabled"],[3,"name"],[1,"ion-text-center"],[4,"ngFor","ngForOf"],[1,"ion-justify-content-around"],["fill","outline","size","small",3,"disabled","click"],[3,"ngStyle"],["slot","end",3,"ngStyle"]],template:function(o,n){1&o&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-buttons",0),e._UZ(3,"ion-menu-button",1),e.qZA(),e.TgZ(4,"ion-segment",2),e.NdJ("ionChange",function(s){return n.onMenuClickHandler(s)}),e.YNc(5,B,4,7,"ion-segment-button",3),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"ion-content"),e.TgZ(7,"ion-grid",4),e.TgZ(8,"ion-row"),e.TgZ(9,"ion-col",5),e.YNc(10,ee,15,9,"ion-card",6),e.ALo(11,"async"),e.qZA(),e.qZA(),e.TgZ(12,"ion-row"),e.TgZ(13,"ion-col",5),e._UZ(14,"app-train-rounds",7),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(4),e.Q6J("value",n.activeRound),e.xp6(1),e.Q6J("ngForOf",n.roundsCfg),e.xp6(5),e.Q6J("ngIf",0!==e.lcZ(11,4,n.rounds$).length),e.xp6(4),e.Q6J("activeRound$",n.activeRound$))},directives:[i.Gu,i.sr,i.Sm,i.fG,i.cJ,i.QI,_.sg,i.W2,i.jY,i.Nd,i.wI,_.O5,D,i.GO,i.gu,i.PM,i.Zi,i.Dq,i.FN,i.q_,i.YG,i.Ie,i.Q$,_.PC],pipes:[_.Ov],styles:[""]}),t})(),pathMatch:"full"},{path:"**",redirectTo:""}];let ne=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[g.Bz.forChild(oe)],g.Bz]}),t})(),te=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[p.u5,_.ez,i.Pc,Z.aw.forChild({extend:!0})]]}),t})(),ie=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[_.ez,p.u5,i.Pc,ne,p.UX,Z.aw.forChild({extend:!0}),te]]}),t})()}}]);